<triggers>
<!-- Rejecting afflictions-->
   <trigger
   enabled="n"
   group="System_Tracking"
   match="^You shake your head and glare hatefully at all your surroundings\.$"
   name="reject_rubeus"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject ("rubeus")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Your enhanced gift of lichdom protects you from the affliction\.$"
   name="reject_lichdom"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject ("lichdom")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Thick shadows drag against your every action\.$"
   name="affnightchoke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>sca:check ("slowed", "choke")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows suddenly leap out from every corner\, violently whirling in a sudden surge\. When the shadows dissipate slightly\, you gasp as you feel strands of darkness still cling to you\, binding you to ([A-Z][a-z]+) in a suffocating\, choking embrace\.$"
   name="affnightchoke2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("choke")
display.warning("Shadow Choke! Get away from " .. string.upper("%1") .. "!")
EnableTrigger("curejinx", true)
prompt:queue (function () EnableTrigger("curejinx", false) end, "nightchoke2")
offense:set_caster ("%1", "choke")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (ceremonially )?enhanced (insight|movement|passion|vivaciousness) repels (\w+)\.$"
   name="affrepel1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local tea_defs = {
  ["insight"] = "white",
  ["movement"] = "green",
  ["passion"] = "oolong",
  ["vivaciousness"] = "black"
}
if defs:has("tea") == tea_defs["%2"] then
  affs:repel("%3")
  if #"%1" == 0 then
    defs:lostdef("tea")
    bals:offbal ("brew", "silent")
  end
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Thin tendrils of shadow reach out from [A-Z][a-z]+ to rake across your skin\.$"
   name="affbleed_nightsweats"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 150)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Drawing back on his tiny bow\, a pixie bound in shadows shoots an arrow straight at you\.$"
   name="pixie_blackout"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has ("blackout") then
if defs:has ("insomnia") then
	defs:lostdef ("insomnia")
end
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A deep melancholy sweeps over you\.$"
   name="affdepression"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("depression")</send>
  </trigger>
    <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) quickly flings a tarot card at you\, and you feel unreasonable lust for (?:[Hh]im|[Hh]er)\.$"
   name="afftarotlust"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("lust", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your mind swims as dizziness overtakes you\.$"
   name="affhypochondria1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hypochondria")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A wave of dizziness suddenly overwhelms you\.$"
   name="affdizziness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("dizziness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sense of deep inner calm descends on you\.$"
   name="affpacifism"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("pacifism")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Sticky strands of webbing spray out (?:from [A-Z][a-z]+ )?to cover you\.$"
   name="affentangled1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Vines reach out and slither up around you\, wrapping you in a tight grip\.$"
   name="aff_liveforest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:The very ground beneath your feet sends a jolt of pleasure through your body|The smoking ground beneath your feet sends a wave of nausea through your body)\.$"
   name="aff_cosmic1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stun")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ points .+? at you\, and sparks fly out of it\.$"
   name="affablaze1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("affablaze2", true)
prompt:queue (function () EnableTrigger("affablaze2", false) end, "affablaze1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Flames erupt on your skin\, blistering your flesh\.$"
   name="affablaze2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning()
if flags:get_check ("magic") == "ignite" then
	prompt:queue (function ()
		flags:del("ignite")
		fst:disable("ignite")
		affs:del({ "lashed_leftarm", "lashed_leftleg", "lashed_rightarm", "lashed_rightleg" })
	end, "cured_lashed_ignite", true)
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Terror descends upon you and your head swims \- you must find shelter\!$"
   name="affagoraphobia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("agoraphobia")
local hn = flags:get_check ("hex") --if I got hit by hex
  if hn then
    if hn==1 then --only once before getting the affliction
      flags:del_check ("hex")--I have detected all the hex attacks	
	 flags:del_check ("recklessness")--and I don't need to check for reckless
    else
	 flags:add_check ("hex", 1)--I still have one more hex attack to detect
    end--if
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The walls close in to suffocate you \- you must escape\!$"
   name="affclaustrophobia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("claustrophobia")
local hn = flags:get_check ("hex") --if I got hit by hex
  if hn then
    if hn==1 then --only once before getting the affliction
      flags:del_check ("hex")--I have detected all the hex attacks	
	 flags:del_check ("recklessness")--and I don't need to check for reckless
    else
	 flags:add_check ("hex", 1)--I still have one more hex attack to detect
    end--if
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Ugly sores break open up\s?on your skin\, seeping with a bloody yellow mucous\.$"
   name="affpox1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("pox")
local hn = flags:get_check ("hex") --if I got hit by hex
  if hn then
    if hn==1 then --only once before getting the affliction
      flags:del_check ("hex")--I have detected all the hex attacks	
	 flags:del_check ("recklessness")--and I don't need to check for reckless
    else
	 flags:add_check ("hex", 1)--I still have one more hex attack to detect
    end--if
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You feel nauseous and your skin turns blotchy\.$"
   name="affpox2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("pox")
local hn = flags:get_check ("hex") --if I got hit by hex
  if hn then
    if hn==1 then --only once before getting the affliction
      flags:del_check ("hex")--I have detected all the hex attacks	
	 flags:del_check ("recklessness")--and I don't need to check for reckless
    else
	 flags:add_check ("hex", 1)--I still have one more hex attack to detect
    end--if
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are scorched by the firewall as you pass through\.$"
   name="affablaze3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You begin to panic as the thought of wearing clothing strangles you\.$"
   name="affvestiphobia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vestiphobia")
local hn = flags:get_check ("hex") --if I got hit by hex
  if hn then
    if hn==1 then --only once before getting the affliction
      flags:del_check ("hex")--I have detected all the hex attacks	
	 flags:del_check ("recklessness")--and I don't need to check for reckless
    else
	 flags:add_check ("hex", 1)--I still have one more hex attack to detect
    end--if
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You close your eyes\, curl up in a ball\, and fall asleep\.$"
   name="affasleep1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("asleep")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You feel incredibly tired\, and fall asleep immediately\.$"
   name="affasleep2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("asleep")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your exhausted mind can stay awake no longer\, and you fall into a deep sleep\.$"
   name="affasleep3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("asleep")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You plummet head first into the ground with a sickening crunch\.$"
   name="affconcussion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"concussion", "damagedhead"})
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Lacking any way to fly and any support\, you plummet to the earth below you\!$"
   name="crow_scavanger"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"concussion", "damagedhead"})
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You (?:are )?bleed(?:ing for)? (\d+) health\.$"
   name="affbleeding1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", %1, true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You feel just as tired as before\.$"
   name="affnarcolepsy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("narcolepsy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cry out in pain as your (left|right) leg twists and snaps beneath you\.$"
   name="afflegsnap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1leg")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dark ray of energy shoots (?:forth|from [A-Z][a-z]+\'s hand) and hits you in the chest\. You gasp in horror as you feel your muscles shrivel and wither\.$"
   name="affenfeeble"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("enfeebled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You yell\, \&quot;I like cheese\!\&quot;$"
   name="affstupidity1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You yell\, \&quot;[A-Z][a-z]+ smells like a goat\!\&quot;$"
   name="affstupidity2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You glare about you in religious indignity and hiss\, \&quot;Heathen\.\&quot;$"
   name="affstupidity3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You let out a massive belch into the air\.$"
   name="affstupidity4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You flip the bird\.$"
   name="affstupidity5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You yell\, \&quot;[A-Z][a-z]+ is cute\!\&quot;$"
   name="affstupidity6"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You fondle yourself absently\.$"
   name="affstupidity7"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^\&quot;The voices\! The voices\! Get them out of my head\!\!\&quot; you moan\, holding your head in pain\.$"
   name="affstupidity8"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You flap your arms madly\.$"
   name="affstupidity9"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An uncomfortable itch tickles you in an embarrassing location\.$"
   name="affscabies"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("scabies")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your muscles spasm and start to lock up\.$"
   name="affrigormortis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("rigormortis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Darkness swells from [A-Z][a-z]+ and strikes at you\.$"
   name="damage_unholywater"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>

<!-- Acrobatics -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ flings [hH](?:is|er) leg out in a vicious jumpkick that slams ringingly into your head\, sending you toppling to the ground\.$"
   name="affacroprone1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"prone", "stun"})
flags:damaged()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ suddenly leaps forward\, flipping into the air and slamming [hH](?:is|er) feet against you\.$"
   name="affacroprone2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
EnableTrigger("affacro_flipleg", true)
prompt:queue (function () EnableTrigger("affacro_flipleg", false) end, "affacroprone2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ tumbles into a backflip to the \w+\, kicking you in the back of the knee\, which gives out and trips you to the ground in the process\.$"
   name="affacroprone3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The bones in your (left|right) (arm|leg) suddenly snap\.$"
   name="affacro_flipleg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1%2")</send>
  </trigger>

<!-- Ascendance -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Unthinking terror seizes your mind as [A-Z][a-z]+ looms up before you\, [hH](?:is|er) visage nightmarish and impossibly powerful\.$"
   name="affascendfear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fear")</send>
  </trigger>

<!-- Astrology -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ raises [hH](?:is|er) arms to the sky\, as an incandescent glow surrounds (?:[hH]im|[hH]er)\.$"
   name="affastroray1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("affastroray2", true)
prompt:queue (function () EnableTrigger("affastroray2", false) end, "affastroray1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^In a brilliant ray of light\, the power of (?:the )?([A-Z][a-z]+) lashes down upon you\.$"
   name="affastroray2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:astro("%1") then
affs:add_queue ("diag", true, "silent")
end</send>
  </trigger>

<!-- Athletics -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slams you hard to the ground\, and you are crushed under [hH](?:is|er) weight\.$"
   name="affathprone1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) tackles your legs and attempts to carry you off to the (\w+)\.$"
   name="affathtackle1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning ("Tackled by " .. string.upper("%1"))
flags:add_check ("tackled", string.upper("%2"))
EnableTrigger("affathtackle2", true)
prompt:queue (function ()
flags:del_check ("tackled")
EnableTrigger("affathtackle2", false)
end, "tackled")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^(?:She|He) succeeds and carries you\, knocking you to the ground\.$"
   name="affathtackle2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function () display.warning ("Tackled " .. string.upper (flags:get_check ("tackled")) end, "afftackle2", true)
affs:prone ({"prone", "stun"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slams [hH](?:is|er) forehead into your skull\, the shock of which stuns you and makes stars dance before your eyes\.$"
   name="affathheadslam1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("affathheadslam2", true)
prompt:queue (function () EnableTrigger("affathheadslam2", false) end, "headslam")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^You are knocked off your feet by the force of the blow\.$"
   name="affathheadslam2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You succeed and carry ([hH]im|[hH]er)\, knocking \1 to the ground\.$"
   name="affathtackling__"
   regexp="y"
   send_to="12"
   sequence="10000"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ clenches [hH](?:is|er) muscles until they bulge and pop\, roaring menacingly at you\. Clearly\, (?:[hH]|[sS]h)e is going to tear you limb from limb\!$"
   name="affathfear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fear")</send>
  </trigger>

<!-- Beastmastery -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? gazes intently at you\, and you feel yourself drawn into [hH](?:is|er) eyes\, which swirl about in a kaleidoscopic array of swirling colours\. Your vision slowly fades into nothing but curiously floating (.+?) spots\.$"
   name="affbeasthypno"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:hypnogaze("%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a loud hiss\, .+? spits a stream of foul liquid into your face\.$"
   name="affbeastpoison"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? rears back and unhinges [hH](?:is|er) jaws\, (?:breath|blast)ing .+? at you\, and you scream .+?\.$"
   name="affbeastminorbreath"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? caws and spits a glob of black phlegm into your face\.$"
   name="affbeastblacklung"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blacklung")</send>
  </trigger>


<!-- Brewmeister -->
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^Placing [hH](?:is|er) hands on [hH](?:is|er) belly\, ([A-Z][a-z]+) opens [hH](?:is|er) gob wide and lets forth a belch that makes the earth shake and the air turn foul\.\nThe stench of \1\'s belch is so rank that your head reels\.$"
   multi_line="y"
   name="affbrewbelch"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>

<!-- Cosmic -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sudden primal fear grips your heart\.$"
   name="affcosmicfear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fear")</send>
  </trigger>

<!-- Cosmic - Celestialism -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? flings a cobalt blue disc at you\, which envelops you in a field of crackling energy\.$"
   name="angel_shakiniel"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--paranoia, anorexia, dementia, hypochondria, claustrophobia
affs:add_queue ("masked", 1)
prompt:add_alert ("angel", "Angel", 8, -1)
prompt:queue (function ()
	affs:add_custom ("shakiniel", "herb", "eat pennyroyal")
end, "affs_add_shakiniel", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Bowing [hH](?:is|er) head and crossing [hH](?:is|er) arms\, .+? sends a bolt of topaz light at you\, which sinks deep into your skull and sets your mind reeling\.$"
   name="angel_japhiel"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--- stupidity, amnesia, hallucinations, shyness, weakness
affs:add_queue ("masked", 1)
prompt:add_alert ("angel", "Angel", 8, -1)
prompt:queue (function ()
	affs:add_custom ("japhiel", "herb", "eat pennyroyal", nil, true)
end, "affs_add_japhiel", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+?\'s eyes shoot forth beams of holy light that strike you and cause your very being to quake\.$"
   name="angel_elohora"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>-- angel: - addiction(galingale, focusmind), paralysis(focusbody), powersink(reishi, phlegmatic), luminous, Stun+Sprawled - (newline)"The overwhelming power of a celestial archangel forces you to humbly kneel down." (Kneel)
affs:add_queue ("masked", 1)
prompt:add_alert ("angel", "Angel", 8, -1)
affs:prone ("paralysis")
prompt:queue (function ()
if not affs:has ("paralysis") then
  affs:add_custom ("elohora", "herb", "eat galingale")
end--if
end, "affs_add_elohora", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A pink glow surrounds .+?\, who reaches forth with outstretched arms and hugs you in a loving embrace\.$"
   name="angel_raziela"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>-- vapors (kombu, melancholichead), pacified(reishi), vestiphobia(wormwood), lovers(galingale), generosity(galingale, phlegmatic) 
affs:add ("blackout")
affs:add_queue ("masked", 1)
prompt:add_alert ("angel", "Angel", 8, -1)
prompt:queue (function ()
if not affs:has ("blackout") then
  affs:add_custom ("raziela", "herb", "eat reishi", nil, true)
end--if
end, "affs_add_raziela", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Bellowing a thunderous war cry\, .+? smites you with a ball of holy flame\.$"
   name="angel_methrenton"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>-- - sensitivity(myrtle), hemophilia (sanguine), justice(reishi), pox (liniment), ablaze
affs:add_queue ("masked", 1)
prompt:add_alert ("angel", "Angel", 8, -1)
prompt:queue (function ()
	affs:add_custom ("methrenton", "herb", "eat myrtle", nil, true)
end, "affs_add_methrenton", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The Handmaiden of Shakiniel raises her shield\, which shoots a ball of crackling blue lightning at you\.$"
   name="affhandmaiden1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Raising her hand towards you\, the Handmaiden of Shakiniel releases a ball of white light\, which envelops you in a paraly[sz]ing flash\.$"
   name="affhandmaiden2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>

<!-- Cosmic - Nihilism -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With [hH](?:is|er) deadly tail\, [A-Z][a-z]+ strikes out at you and stings you\.$"
   name="affsting"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("masked", 1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a cold smile\, .+? digs [hH](?:is|er) claws into your flesh\, sending a bolt of excruciating pain through your body\.$"
   name="affdemon_nifilhema"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("masked", 1)
prompt:queue (function ()
	if string.find (prompt ["status"], "p") then
		affs:add ("shackled")
		affs:masked (-1)
	end
	prompt:add_alert ("demon", "Demon", 8, -1)
end, "demon_nifilhema", true)
affs:add_queue ("masked", 1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? grabs your shoulders and gutturally whispers into your mind\. Though the language is harsh and unknown\, the words twist in your brain over and over\.$"
   name="affdemon_baalphegar"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--Confusion (penny), Dementia (penny), Epilepsy (focus mind, kombu), Paranoia (penny), and Stupidity (penny)
prompt:add_alert ("demon", "Demon", 8, -1)
affs:add_queue ("masked", 1)
affs:add_queue ("add_custom", "demon_baalphegar", "focus", "focus mind")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? vomits forth a stream of noxious fluid that strikes you\, coating you with a thick green slime\.$"
   name="affdemon_gorgulu"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:add_alert ("demon", "Demon", 8, -1)
affs:add_queue ("masked", 2)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? forms a ball of darkness in [hH](?:is|er) palm\, then hurls it at you\, striking you full in the chest\. Shadowy tendrils burst forth and slither over your skin\.$"
   name="demon_luciphage"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	affs:masked (1)
	prompt:add_alert ("demon", "Demon", 8, -1)
end, "demon_luciphage1", true)
prompt:queue (function ()
	if string.find (prompt ["status"], "p") then
		affs:add ("paralysis")
		affs:masked (-1)
	end
end, "demon_luciphage2", true)
affs:add_queue ("masked", 1)
</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Clenching [hH](?:is|er) fists\, .+? screams in rage at you\, and a ball of fire erupts at your feet\, briefly enveloping you\.$"
   name="affdemon_ashtorath"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:add_alert ("demon", "Demon", 8, -1)
flags:damaged ()
prompt:queue (function ()
	if not affs:has ("recklessness") then
		affs:add_custom ("affdemon_ashtorath", "salve" "apply mending to legs")
	end
end, "affdemon_asthorath", true)
affs:add_queue ("masked", 1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The Nil Grim Horror rams his bony head into your skull\, causing the world to blank out around you\.$"
   name="affgrim1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The Nil Grim Horror grabs ahold of you with a rotting taloned claw\, draining all warmth from your body\.$"
   name="affgrim2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("chills")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The Nil Grim Horror spreads its leperous wings and looms up before you\, causing you to scream in a primal panic that rises up from your gut\.$"
   name="affgrim3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fear")</send>
  </trigger>

<!-- Dreamweaving -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sudden shiver shoots up your spine\, making you involuntarily jerk as a creeping sensation crawls over your skin\.$"
   name="affdreamblackout"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")
affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("dreamblackout", "herb", "eat kafe")
	affs:masked (1)
	display.warning("Dreamweaver attack!")
end, "affs_add_dreamblackout", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Strange noises can be heard behind you and you see movement out of the corner of your eye\. What\'s that\? There it is again\!$"
   name="affdreamrandom"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("affdreamrandon", "focus", "focus mind", nil, true)
	affs:masked (1)
	display.warning("Dreamweaver attack!")
end, "affs_add_dreamrandom", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slams [hH](?:is|er) hand into the air in front of you\, and you suddenly feel lightheaded and weak\.$"
   name="affdreampuncture"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("lightheaded")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dark void opens up in your mind and devours your thoughts\.$"
   name="affdreamvoid"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not bals:has("herb") then
  bals:onbal("herb")
end
affs:add_queue("void")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:You smile sadistically as you imagine yourself running your sword through a helpless opponent\.|You stop for a moment to think about how great it would be if you were a god\.)$"
   name="sympdaydreaming"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("daydreaming")</send>
  </trigger>

<!-- Elementalism -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ raises a hand towards you and blasts you with cold\, frigid air\.$"
   name="aqpreserve"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("chills")
EnableTrigger ("aqpreservedead", true)
prompt:queue (function ()EnableTrigger ("aqpreservedead", false)end, "aqpreserve")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Pointing at you\, [A-Z][a-z]+ hisses and narrows [hH](?:is|er) eyes\. Flames erupt on your skin\, blistering your flesh\.$"
   name="affelemfire"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning()</send>
  </trigger>

<!-- Elementalism - Aeromancy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:A cold wind blows chill grey clouds in from the north\. The clouds circle around you\, suddenly constricting into a tight band of compressed air that makes it hard to breathe|[A-Z][a-z]+ raises [hH](?:is|er) arm and clenches [hH](?:is|er) fist\, causing air to swirl around you\. The wind suddenly tightens like painful\, constricting bands squeezing the breath from your body\, but you grit your teeth and persevere\, but you are left with more pressure than before)\.$"
   name="aff_aero_northwind"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send> affs:add_queue ("coil")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A chilling wind from the south sends an odd scent to your nostrils\.$"
   name="aff_aero_southwind"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("southwind", "focus", "eat pennyroyal", nil, true)
	affs:masked (1)
end, "affs_add_southwind", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A swift gust from the east pierces (?:at |into )?your extremities\, plunging through your (left|right) (arm|leg)\.$"
   name="aff_aero_eastwind"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("pierced_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You run into a network of rainbows\, the light and colour confusing you and making you disoriented\.$"
   name="aff_aero_rainbowclouds"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("confusion")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As you rise into the air\, you are entangled in an invisible net and fall back to the ground\.$"
   name="aff_aero_airnet"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ raises [hH](?:is|er) staff\,? and a blast of wind whips around you\, stripping your levitation defen[cs]e and forcing you to the ground\.$"
   name="aff_aero_nolev"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("levitate")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Thunder roars and a bolt of lightning strikes you\, knocking you to the ground\.$"
   name="aff_aero_prone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ()
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^[A-Z][a-z]+ raises [hH](?:is|er) staff\,? and a blast of wind whips around you\.\nThe wind lifts you up into (?:the )?the air and flings you into the sky\.$"
   multi_line="y"
   name="aff_aero_flyer"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:add_queue("flying")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are caught in a powerful twister that hurtles you to the ground\.$"
   name="aff_aero_noflyer"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("flying")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The freezing blizzard nips at your fingers and toes\.$"
   name="aff_aero_cold"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("chills")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An ear\-splitting thunderclap peals through the air as .+? flares h(?:is|er) wings\, opening h(?:is|er) beak and unleashing an orb of crackling white lightn?ing towards you\, tendrils of electricity enveloping your body and causing your skin to blacken and body to spasm in pure agony\.$"
   name="aff_aero_thunderbird"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("epilepsy")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A cloudy tendril lashes at you\, filling your mind with disturbing images\.$"
   name="aff_aero_miasma"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("miasma", "herb", "eat pennyroyal", nil, true)
	affs:masked (1)
end, "affs_add_miasma", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your magical protection is blown away\.$"
   name="aff_aero_unshield"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("shield")</send>
  </trigger>

<!-- Elementalism - Aquamancy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A biting cold seeps deep into your skin\.$"
   name="affaquacold1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A biting cold seeps deep into your bones from the frigid water\, making your teeth chatter\.$"
   name="affaquacold2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")
affs:add_queue("chills")
affs:del("ablaze")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A biting cold seeps deep into your bones from the frigid water\, giving you massive hypothermia\.$"
   name="affaquacold3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")
affs:prone("frozen")
affs:del("ablaze")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An enormous wave sweeps over you\, knocking you to the ground\.$"
   name="affaquawave"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Ice begins to form on your skin but an inner warm rises up and quickly melts it away\.$"
   name="affaquaice1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A thin layer of ice forms over your skin\, making you shiver\.$"
   name="affaquaice2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")
affs:add_queue("chills")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Ice crystals form over your skin\, gripping you with a numbing pain as your flesh begins to freeze\.$"
   name="affaquaice3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue("fire")
affs:prone("frozen")
display.warning("Frozen solid!")</send>
  </trigger>

<!-- Elementalism - Geomancy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A deep\, foreboding hum emanates from the tainted earth\, and then you are suddenly slammed into the ground by an irresistable force\.$"
   name="affgeoprone1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
defs:del_queue ("levitate")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A violent tremor rocks the land\, causing the earth to shake and the ground to buck beneath your feet\.$"
   name="affgeoprone2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
--prompt:queue (function () affs:add_custom ("geolegs", "salve", "apply mending to legs") affs:add_custom ("geoarms", "salve", "apply mending to arms") end, "geotremors", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Fumes rise up from the tainted earth and make you cough\. Ugly\,? cankerous sores break out on your skin\, dripping with pus\.$"
   name="affgeotaint"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("taint_sick")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ twirls [hH](?:is|er) staff in front of you\, which spews forth vile black oil that covers you in a sticky morass of filth\.$"
   name="affgeogunk"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("gunk")</send>
  </trigger>

<!-- Elementalism - Pyromancy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Thick black smoke wreaths you\, and you begin to hack and cough\.$"
   name="aff_pyro_asthma"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("asthma")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:A rolling wave of fire sweeps over you|You are swarmed by several burning salamanders\, setting you ablaze)\.$"
   name="aff_pyro_ablaze"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Your flesh is charred\, and you receive (first|second|third|fourth) degree burns\.$"
   name="aff_pyro_burnlevel"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("burned", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your flesh burns as a sheet of shimmering fire envelops you\.$"
   name="aff_pyro_damage1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:burning()
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your skin and lips crack amid this parching heatwave\.$"
   name="aff_pyro_sunallergy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("sunallergy")
affs:burning()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A burning salamander breathes a cloud of superheated air into your face\.$"
   name="aff_pyro_dizziness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("dizziness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A ball of wild fire smashes into you\, searing your flesh\.$"
   name="aff_pyro_wildfire"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:burning()
EnableTrigger("aff_pyro_ashlimb", true)
prompt:queue (function () EnableTrigger("aff_pyro_ashlimb", false) end, "aff_pyro_wildfire")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^You scream as your entire (left|right) (arm|leg) is reduced to ash\.$"
   name="aff_pyro_ashlimb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("amputated_%1%2")
affs:add_queue ("bleeding", 500)
affs:add_queue ("stun")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Liquid fire rains down on you\, broiling your flesh\.$"
   name="aff_pyro_firerain"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:burning()
EnableTrigger("aff_pyro_ashlimb", true)
queue:add(function () EnableTrigger("aff_pyro_ashlimb", false) end)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You begin to sweat profusely in this sweltering heat\.$"
   name="aff_pyro_slickness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("slickness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You breathe in some black ashes\,? and then begin coughing hoarsely\.$"
   name="aff_pyro_blacklung"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blacklung")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A burning salamander spits in your eyes\.$"
   name="aff_pyro_blind"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("sixthsense")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The air visibly wavers around .+? as seething flames erupt across [hH](?:is|er) form\. With a high\-pitched shriek\, .+? releases a torrid stream of white\-hot fire at you\, causing you to scream in utter agony\, flames licking across your skin as it blisters\.$"
   name="aff_pyro_phoenix"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your flesh blisters as you reach through the ring of fire that surrounds [A-Z][a-z]+\.$"
   name="aff_pyro_flamering"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:burning()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+\'s eyes glow red as five jagged rifts open up in the air around [hH](?:im|er)\, each shooting forth a blast of seething fire at you\. Your flesh chars as you are knocked senseless in the blinding explosion\.$"
   name="aff_pyro_blackout"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")
affs:burning()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The torr?id wind fans the flames on you\, roasting your flesh\.$"
   name="aff_pyro_twirl"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:burning()</send>
  </trigger>

<!-- Harmony -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A soft pink glow flows out of [A-Z][a-z]+\'s chest and covers you\.$"
   name="affharmonychuuti"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("peace")</send>
  </trigger>

<!-- Healing WTF WTF WTF WTF-->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A warm tingle runs through your body as [A-Z][a-z]+ touches two fingers to your forehead\, shifting a brilliant aura to you\.$"
   name="affhealaura"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--some auras cure defenses, like insomnia
display.warning ("Healing aura transferred to you")
affs:add_queue ("add_custom", "affhealaura", "herb", "eat merbloom")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your mind relaxes and you feel as if you could sleep\.$"
   name="affhealaura"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("insomnia")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a grand gesture of righteous fury\, ([A-Z][a-z]+) bedevils you with [hH](?:is|er) afflictions\.$"
   name="affhealbedevil"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--When you get bedeviled, it's like the plague, where afflictions will pop up when you cure them
affs:add_queue("bedeviled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+)\'s presence prevents you from curing your (bedeviling sickness|warped aura)\.$"
   name="affhealfail"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local aff = "Bedevil"
if "%2" == "warped aura" then
	  aff = "AuraWarp"
	  for i=1,5 do
		display.warning ("Aurawarp")
	end
	prompt:add_alert ("aurawarp", "Aurawarp", 10)
end
display.warning ("Move away from %1 to cure " .. aff)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) bows ([hH](?:is|er)) head and closes \2 eyes\, hooking \2 finger in a terrible wrenching motion as your insides twist and turn in a hideously contorted dance\.$"
   name="affaurawarp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--It prevents cures from working; all cures?
affs:add_queue("aurawarp")
--failsafe:exec("aurawarp", 10)
for i=1,5 do
	display.warning ("Aurawarp")
end
prompt:add_alert ("aurawarp", "Aurawarp", 10)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your insides twist as the dread plague ravages your internal homeostasis\.$"
   name="affaurawarp_homeostasis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("aurawarp")
affs:add_queue("homeostasis")
for i=1,5 do
display.warning("Homeostasis")
end
prompt:add_alert ("homeo", "Homeo", 10)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your insides twist and turn\, closing up your throat\.$"
   name="affaurawarp_eat_smoke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("aurawarp")
affs:add_queue("homeostasis")
for i=1,5 do
display.warning("Homeostasis")
end
prompt:add_alert ("homeo", "Homeo", 10)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your insides twist and turn\, causing your hands to uncontrollably shudder\.$"
   name="affaurawarp_apply"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("aurawarp")
for i=1,5 do
display.warning("Homeostasis")
end
prompt:add_alert ("homeo", "Homeo", 10)</send>
  </trigger>

<!-- Hexes -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:[A-Z][a-z]+ grabs some glowing glyphs and throws them at you|Glowing glyphs in the air flare and explode in your face|Glowing glyphs drift in from the \w+ and explode in your face)\.$"
   name="affhex1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
affs:add ("hex")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ draws a glowing glyph in the air and flings it at you\. Your mind suddenly grows befuddled and clouded\.$"
   name="affjinx"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("jinx")
display.warning ("You've been Jinxed!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your limbs twitch of their own volition under the curse of the jinx\, refusing to obey your commands\.$"
   name="sympjinx"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("jinx")
display.system ("Repeat Action!")</send>
  </trigger>

<!-- Highmagic -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A cobalt blue hexagram shoots up from below\.$"
   name="affhexagram1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("affhexagram2", true)
prompt:queue (function () EnableTrigger("affhexagram2", false) end, "affhexagram1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^It slams into you\, knocking you to the ground\.$"
   name="affhexagram2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
flags:del_check ("intrees")
affs:del ("intrees")
fst:disable ("climbing")
display.warning("Knocked down by Hexagram!")
prompt:add_alert ("hexa", "Hexa", 5)
end, "affhexagram2", true) </send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ mutters and traces complex glowing symbols before (?:[hH]im|[hH]er)\. The symbols lash out at you\, and your body painfully desiccates as vitality is drained from you\.$"
   name="affbinah"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("binah_sphere")</send>
  </trigger>

<!-- Hunting - Ecology -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Mumbling softly to [Hh](?:er|im)self\, [A-Z][a-z]+ points a finger at you\, and you are gripped by the undulating image of (a screeching bat|a hissing snake|burning herbs)\.$"
   name="affbane"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local bane = "herb"
if string.find("%1", "bat") then
  bane = "bat"
elseif string.find("%1", "snake") then
  bane = "snake"
end
affs:add_queue("bane_" .. bane)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A strange bone creature (?:flies in from the \w+|leaps out of [A-Z][a-z]+\'s hands) and attacks you.+"
   name="affetish"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("fetish")
system:poisons_on ()
prompt:queue (function () affs:masked (1) flags:del_check ("fetish") end, "fetish", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The cloud of fragrant smoke coalesces into the scene of a soaring mountain\. An ominous rumbling soon heralds an avalanche of rock that comes crashing down the mountainside\.\nYou are buried under an avalanche of rock and rubble\.$"
   multi_line="y"
   name="affsmudge1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
flags:add_check ("recklessness")
affs:add_queue ("broken_rightleg")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The cloud of fragrant smoke coalesces into the scene of rolling hills silhouetted against a raging thunderstorm\. Mud begins sliding off the hills\, pounding down all around you\.\nYou are caught in the onslaught and go down in a wave of rolling mud\.$"
   multi_line="y"
   name="affsmudge2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("muddy")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The cloud of fragrant smoke coalesces into the scene of desert sand dunes\. Suddenly a sandstorm rises up over a dune and rushes down atop you\.\nThe whirling sands scour your flesh\.$"
   multi_line="y"
   name="affsmudge3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 300)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The cloud of fragrant smoke coalesces into the scene of a verdant swamp\.\nYou gasp in horror as you begin to sink into a patch of quicksand\.$"
   multi_line="y"
   name="affsmudge4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Quicksand! DON'T MOVE!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The cloud of fragrant smoke coalesces into the scene of a roaring forest fire\. Flaming branches rain down all around you\.\nA burl cracks open next to you\, covering you in burning sap\.$"
   multi_line="y"
   name="affsmudge5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? stabs you with a deadly stinger attached to its bone armour\.$"
   name="afffamiliarsting"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on()</send>
  </trigger>

<!-- Hunting - Tracking -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dart streaks from out of nowhere and slams into you\.$"
   name="affdarts"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>---WTF IS THIS?!
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Pain sears through your (left|right) arm as .+? leaps up and clamps its powerful jaws around it\.$"
   name="affclammp1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("clamped_%1arm")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You almost lose your balance as .+? viciously shakes your (left|right) arm\, tearing your flesh and causing massive bleeding\.$"
   name="affclamp2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("clamped_%1arm")
affs:add_queue ("bleeding", 150)
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ground suddenly falls away from beneath you and you go tumbling into a pit\, landing painfully on the hard ground\.$"
   name="affpit1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:del ("climbing")
affs:add ("pit")
if not defs:has ("levitate") then
  affs:add_queue ("broken_leftleg")
  affs:add_queue ("broken_rightleg")
end--if
parry:init ()
stance:init ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ground suddenly falls away from beneath you and you go tumbling into a pit\. Before you hit the bottom\, you are skewered upon some spikes\!$"
   name="affpit2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:del ("climbing")
affs:add ("pit")
if not defs:has ("levitate") then
  affs:add_queue ("broken_leftleg")
  affs:add_queue ("broken_rightleg")
end--if
parry:init ()
stance:init ()
system:poisons_on()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ground suddenly falls away from beneath you and you go tumbling into a pit\, but thankfully something soft and spongy breaks your fall\-\-Holy Nil\, it\'s a pile of snakes\!$"
   name="affpit3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:del ("climbing")
affs:add ("pit")
if not defs:has ("levitate") then
  affs:add_queue ("broken_leftleg")
  affs:add_queue ("broken_rightleg")
end--if
parry:init ()
stance:init ()
system:poisons_on()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A small anvil drops down\, cracking painfully against your skull\.$"
   name="affanvil"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("concussion")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A clamp snaps shut on your foot\, pinning you to the ground\.$"
   name="affbeartrap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("roped")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^[A-Z][a-z]+ leaps in from the \w+ straight at \w+\!\n[A-Z][a-z]+ pounces on you from an unseen hiding place\.$"
   multi_line="y"
   name="affambush"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
defs:del_queue ("shield")</send>
  </trigger>

<!-- Illusions -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ raises [hH](?:is|er) hands and a hideous monstrosity rises up from the ground and looms over you\. It stares at you with bulging eyes and dozens of scabrous claws\. This nightmare then opens its massive maw\, which drips with thick mucus and reveals rows of dagger\-like teeth\, and a primal fear surges up the length of your spine\.$"
   name="affillfear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("fear")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ waves [hH](?:is|er) hands at you\, and momentarily you see nothing but a throbbing red glow\.$"
   name="affillwounds"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("illusory_wounds")</send>
  </trigger>

<!-- Illusions - Glamours -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ weaves a glamour of radiant prismatic colours\, dazzling you with a burst of (.+?)\.$"
   name="affprismatic1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("glamour", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ spreads [hH](?:is|er) hands wide and weaves a vibrant spray of prismatic colours that dance and swirl through the air in a riotous pandemonium of hues\.\nWild\, abstract shapes of (.+?) splatter across your vision\, sending you reeling\.$"
   name="affprismatic2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("glamour", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ weaves [hH](?:is|er) hands towards you and light erupts into fascinating patterns that overwhelm your senses\.$"
   name="afftransfixed"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("blindness") and not defs:has("sixthsense") then
affs:add_queue("transfixed")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^[A-Z][a-z]+ weaves [hH](?:is|er) hands and fountains of dazzling light flare across your vision\, erupting in novas of colour that burn into your eyes\.\n(A dazzling orange afterimage burns into your sight\.|Vision returns\, though you no longer see the world through the sixth sense\.)$"
   multi_line="y"
   name="affilldazzle"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if string.find("%1", "afterimage") then
  affs:add_queue ("afterimage")
end
-- TODO: auto-enable sixthsense?</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Dazzling lights flash across your vision\, leaving you with naught but a fading orange afterimage\.$"
   name="affafterimage"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("afterimage")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ weaves a beautiful swirl of rainbow\-coloured lights\, casting them into alluring patterns of barely restrained imagery\. With a graceful gesture\, (?:[hH]e|[sS]he) conducts the rainbow patterns to spin recklessly around you\.$"
   name="affrainbows"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("rainbow_patterns")
EnableTriggerGroup("System_Rainbows", true)
fst:enable ("rainbow_patterns")
-- TODO: auto-enable sixthsense?</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The maelstrom of rainbow colours whips violently around\, slamming (.+?) into you\.$"
   name="affmaelstrom"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:glamour("%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ traces blasphemous patterns in the air with [hH](?:is|er) finger\, weaving a deadly glamour that constricts tightly around you\, unraveling your defenses\.\n\d+h\,"
   name="affdeadlypattern"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>affs:reject_try ()
display.warning("Check your defenses!")
affs:add_queue ("add_custom", "deadly pattern", "herb", "eat merbloom")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too close to the fireworks and are caught in the blazing explosion\!$"
   name="aff_fireworks"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
affs:burning()</send>
  </trigger>

  <trigger
   enabled="n"
   group="System_Rainbows"
   match="^You heave a sigh of relief as the beautiful and maddening rainbow patterns that swirl feverishly around you fade away in a multi\-coloured smoke\.$"
   name="affrainbowsdone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:del ("rainbow_patterns")
fst:fire ("rainbow_patterns", "now")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Bright red bubbles float by as your mind drifts from confusion\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_confusion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("confusion")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Melting orange clocks seep across the ground as contorted animals march past\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_hallucinations"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hallucinations")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Glowing yellow bursts of light flash across your vision\, filling you with unsated desire\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_addiction"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("addiction")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Abstract green blotches spin around you\, causing you to stumble\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_clumsiness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("clumsiness")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Vivid blue spirals spin wildly around you\, and suddenly you are seeing double\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_dizziness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("dizziness")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Blinding violet lights flash maddeningly in front of your eyes\, which twitch uncontrollably\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_epilepsy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("epilepsy")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Rainbows"
   lines_to_match="2"
   match="^Snaking vines of dark indigo creep across your skin\, holding you tight\.\nBlood drips from your nose as the rainbow lights swirl around you in a maddening frenzy\.$"
   multi_line="y"
   name="affrainbow_paralysis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>

<!-- Illusions - Phantasms -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ wiggles [hH](?:is|er) fingers before you\, and you sense a shadow passing overhead\.$"
   name="affphantoms"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("phantoms")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadow tendrils wrap around your limbs\.$"
   name="affphantoms1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone({"entangled", "phantoms"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows creep up all around you and close in\.$"
   name="affphantoms2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "claustrophobia", "phantoms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows flicker before you\, forming strange and weird shapes\.$"
   name="affphantoms3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "confusion", "phantoms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows seep into your clothing\, crawling like dark maggots\.$"
   name="affphantoms4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "vestiphobia", "phantoms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadowy shapes rise up around you and form into familiar shapes\.$"
   name="affphantoms5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "hallucinations", "phantoms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadowy voices whisper dark warnings in your ear\.$"
   name="affphantoms6"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "paranoia", "phantoms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You scream out in pain as a phantom rakes your skin with its sharp claws\.$"
   name="affphanclaws"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 400)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ weaves a fierce phantasm and sets it upon you\, where it begins to hungrily rake your skin with its claws\.$"
   name="affphanclaws2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 400)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As you try to go that way\, you find yourself entangled in a purple web of phantasms\, screaming and clawing at you\, entangling you in their grasp\.$"
   name="affphanwall"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sends a tendril of shadows into your face\. You try to cry out as your vision is blotted and spears of pain stab into your eye sockets\.$"
   name="affphaneyes"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("sixthsense")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the attack punches through [A-Z][a-z]+\'s phantom armour\, a backlash of crackling phantasmal energy lashes out at you\.$"
   name="affphanarmour"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+(?:\'s phantom sightstealer projects thousands of voices into your mind| raises an arm\, pointing in your direction and suddenly thousands of voices bombard you)\, urging you to watch your back\, to kill\, while startling you with unexpected screeches\.$"
   name="affphanwhisper"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("disrupted")</send>
  </trigger>

<!-- Kata -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) applies precise pressure and burning agony shoots up your (chest|gut|head|left arm|left leg|right arm|right leg) as it snaps\.$"
   name="kata_snap_grapple_pop"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
if part == "chest" then
  affs:add_queue ("brokenchest")
elseif part == "head" then
  affs:add ("blackout")
elseif part ~= "gut" then
  affs:add_queue ("broken_"..part)
end
prompt:queue (function ()
	affs:add ("grappled", nil, "%1")
end, "ungrappled_%1", true)
wounds:monk_attack ({"Nekotai", "Ninjakari", "Shofangi", "Tahtetso",}, part, 300)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a quick spin\, [A-Z][a-z]+ kicks you in the (chest|gut|head|left arm|left leg|right arm|right leg) with [hH](?:is|er) (?:left|right) foot\.$"
   name="kata_kick"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Nekotai", "Ninjakari", "Shofangi", "Tahtetso",}, part, 300, "kick")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) firmly holds you in place with an iron\-strong grip\.$"
   name="kata_hold"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "body", "%1", "hold")
prompt:unqueue ("ungrappled_%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) swiftly grabs you and hurls you forcefully to the ground\.$"
   name="kata_throw"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTriggerGroup ("System_NekotaiMods", false)
prompt:queue (function () EnableTriggerGroup ("System_NekotaiMods", false)end, "kata_throw")
prompt:queue (function ()
	affs:add ("grappled", nil, "%1")
end, "ungrappled_%1", true)
affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (chest|gut|head|left arm|left leg|right arm|right leg) is grappled by ([A-Z][a-z]+)\. You must writhe to escape\.$"
   name="kata_grappled"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
if not affs ["grapples"] [part] then
  affs:add_queue ("grappled", part, "%2")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) releases [hH](?:is|er) fierce grapple on you\.$"
   name="kata_released"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	affs:add ("grappled", nil, "%1")
end, "ungrappled_%1", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a snarl\, ([A-Z][a-z]+) clutches your throat and begins to painfully choke the life from you\.$"
   name="kata_choke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "head", "%1")
prompt:unqueue ("ungrappled_%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You gasp helplessly for breath as ([A-Z][a-z]+) continues to viciously choke you\.$"
   name="kata_choking"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "head", "%1")
</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) locks your (chest|gut|head|left arm|left leg|right arm|right leg) in a solid grapple\.$"
   name="kata_grapple"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
affs:add_queue ("grappled", part, "%1")
prompt:unqueue ("ungrappled_%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ expertly tosses you\, sending you careening through the air away from (?:[hH]im|[hH]er)\.$"
   name="kata_toss"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled")
affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Drawing back [hH](?:is|er) (?:left|right) fist\, [A-Z][a-z]+ punches you in the (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="kata_punch"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Nekotai", "Ninjakari", "Shofangi", "Tahtetso",}, part, nil, "punch")</send>
  </trigger>
	
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^Your nose is savagely hit and breaks\, causing blood to splurt forth\.$"
   name="kata_breaknose"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("brokennose")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^The massive trauma to your head has damaged your skull and brain considerably\.$"
   name="kata_concussion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("concussion")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^A prickly stinging overcomes your body\, fading away into numbness\.$"
   name="kata_paralysis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^Your (left|right) leg shatters under the force of the blow\.$"
   name="kata_breakleg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("broken_%1leg")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^Your (left|right) arm breaks with a loud crack\.$"
   name="kata_breakarm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("broken_%1arm")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^Your (left|right) arm flops uselessly as your elbow emits a loud popping crack\.$"
   name="kata_crackelbow"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("elbow_%1arm")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^Your (left|right) leg buckles as your kneecap emits a loud popping crack\.$"
   name="kata_crackkneecap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("kneecap_%1leg")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_KataMods"
   match="^The force of the blow forces you to stagger backwards\, and you feel slightly dazed\.$"
   name="kata_stun"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("stun")</send>
  </trigger>
  
<!-- Kata - Nekotai -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Disgustingly\, [A-Z][a-z]+ spits at you\, hitting you directly in your face\.$"
   name="affnekospit"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Slashing viciously at you\, [A-Z][a-z]+ rends you in the (chest|gut|head|left arm|left leg|right arm|right leg) with (.+?)\.$"
   name="nekotai_rend"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Nekotai"}, part, nil, "%2")
flags:add_check ("recklessness")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) slashes your (chest|gut|head|left arm|left leg|right arm|right leg) with such force that the blades warble\, creating an earsplitting screech that whistles through the air\.$"
   name="nekotai_kaife"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack ({"Nekotai",}, part, nil, "%1")
flags:add_check ("recklessness")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+? gracefully cuts (.+?) across your head with an Angkhai arc\, slicing open your throat in three crimson streaks\.$"
   name="nekotai_angkhai_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai"}, "head", 0, "%1")
system:poisons_on ()
affs:add_queue({"slitthroat", "relapsing"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ rips .+? through your (left|right) leg tendon in an Angkhai arc\, leaving you crippled\.$"
   name="nekotai_angkhai_leg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai"}, "%1leg", 0)
system:poisons_on ()
affs:add_queue({ "tendon_%1leg", "relapsing" })
affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a hiss\, ([A-Z][a-z]+) slams [hH](?:is|er) nekai against your throat and presses against your windpipe\, painfully choking the life from you\.$"
   name="nekotai_choke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "head", "%1")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack ({"Nekotai",}, "head")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a sudden strike\, ([A-Z][a-z]+) skewers you with two nekais in the (chest|head|gut|left arm|right arm)\, holding you in place\.$"
   name="nekotai_ootangk"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
affs:add_queue ("grappled", part, "%1", "ootangk")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack ({"Nekotai",}, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Leaping up and twisting in the air\, [A-Z][a-z]+ smashes [hH](?:is|er) (?:left|right) foot into your (chest|gut|head|left arm|right arm)\, which trembles from the force of the kick\.$"
   name="nekotai_sprongk"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack ({"Nekotai",}, part)
affs:add_queue("stiff_" .. part)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Throwing a kick in the Spronghai style\, [A-Z][a-z]+ slams [hH](?:is|er) (?:left|right) heel on your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="nekotai_spronghai"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack ({"Nekotai",}, part)
affs:add_queue("hemophilia")
flags:add_check ("recklessness")
affs:add_queue ("bleeding", 250)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ springs in from the \w+\, landing in a silent arc\.$"
   name="nekotai_spring"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ("Nekotai")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="Speedy as a crouching scorpion\, [A-Z][a-z]+ twists back violently and sends you sprawling\.$"
   name="nekotai_scorpion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Twisting in a circle\, [A-Z][a-z]+ plunges .+? into your gut\, driving the foot so hard that it snaps your spine\.$"
   name="nekotai_sprongma_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("severedspine")
wounds:monk_attack ({"Nekotai",}, "gut")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Twisting in a circle\, [A-Z][a-z]+ plunges .+? into your chest\, smashing your chest inward\.$"
   name="nekotai_sprongma_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("collapsedlungs")
wounds:monk_attack ({"Nekotai",}, "chest")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Fountains of blood erupt as ([A-Z][a-z]+) neatly removes [hH](?:is|er) blades from your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="nekotai_amihai"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack (nil, part)
flags:damaged ()
affs:add_queue ("bleeding", 280)
prompt:queue (function ()
	affs:add ("grappled", nil, "%1")
end, "ungrappled_%1", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices .+? (?:with|in) the Angknek style through your (left|right) (arm|leg)\, the pain making you slow and weak\.$"
   name="nekotai_angknek_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = "%1%2"
wounds:monk_attack ({"Nekotai",}, part)
system:poisons_on ()
affs:add_queue("sliced_"..part)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ gouges .+? (?:with|in) the Angknek style into your gut\, spilling your steaming entrails\.$"
   name="nekotai_angknek_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "gut")
system:poisons_on ()
affs:add_queue("slicedopengut")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ punctures .+? into your chest (?:with|in) the Angknek style\, and a sharp pain streaks across your lungs\.$"
   name="nekotai_angknek_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "chest")
system:poisons_on ()
affs:add_queue("puncturedchest")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slashes .+? into your head (?:with|in) the Angknek style\, adorning your cheek with a gash of crimson\.$"
   name="nekotai_angknek_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "head")
system:poisons_on ()
affs:add_queue ("gashedcheek")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Twirling .+?\, [A-Z][a-z]+ shreds your (left|right) (arm|leg) (?:with|in) the Angkai style\, sending piercing pain through your nerves\.$"
   name="nekotai_angkai_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = "%1%2"
wounds:monk_attack ({"Nekotai"}, part)
system:poisons_on ()
affs:add_queue("pierced_"..part)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:With|In) the Angkai style\, [A-Z][a-z]+ plunges .+? into your head\, painfully gouging out your eyes\.$"
   name="nekotai_angkai_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "head")
system:poisons_on ()
if not affs:has("peckedeye_left") then
  affs:add_queue("peckedeye_left")
else
  affs:add_queue("peckedeye_right")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices .+? through your chest (?:with|in) the Angkai style\, and you suddenly have trouble breathing\.$"
   name="nekotai_angkai_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "chest")
system:poisons_on ()
affs:add_queue("phrenicnerve")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ shreds .+? across your gut in a vicious Angkai arc\, painfully traumatizing your liver\.$"
   name="nekotai_angkai_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Nekotai",}, "gut")
system:poisons_on ()
affs:add_queue("relapsing")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ cuts .+? with an Angkhai arc into your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="nekotai_angkhai"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Nekotai",}, part)
system:poisons_on ()
affs:add_queue("relapsing")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NekotaiMods"
   match="^Your (\w+) starts to throb(?:\, and blood trickles out of your \1)?\.$"
   name="nekotai_kaiga"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("vessel", 1)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NekotaiMods"
   match="^Your (left|right) (arm|leg) snaps painfully\.$"
   name="nekotai_oriama1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("broken_%1%2")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NekotaiMods"
   match="^Your (left|right) (arm|leg) is mangled into a twisted mass of bloody\, broken bone\!$"
   name="nekotai_oriama2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("twisted_%1%2")</send>
  </trigger>

<!-- Kata - Ninjakari -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Taking (.+?) in two hands\, ([A-Z][a-z]+) throws it out to its full length\, then whips it down upon you\, tearing your flesh and coiling it tightly about your (head|chest|gut|left arm|left leg|right arm|right leg)\.$"
   name="ninjakari_ninshi"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub ("%3", " ", "")
affs:add_queue ("grappled", part, "%2", "ninshi")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack ({"Ninjakari",}, part, nil, "%1")
system:poisons_on ()
if string.find (part, "leg") then
	affs:add_custom ("ninshi_legs", "salve", "apply regeneration to legs", system:getkey (affs ["salve"], "tendon_leftleg"))
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Twirling (.+?) so fast that it whistles\, [A-Z][a-z]+ grazes your (head|chest|gut|left arm|left leg|right arm|right leg)\, opening up a deep gash\.$"
   name="ninjakari_ninchu"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack({"Ninjakari",}, part, 0, "%1")
flags:add_check ("recklessness")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Springing up\, [A-Z][a-z]+ whirls [hH](?:is|er) leg around\, pounding your (head|gut)"
   name="ninjakari_akogh"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1", nil, "kick")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Springing up\, [A-Z][a-z]+ whirls [hH](?:is|er) leg around\, pounding your (left|right) (arm|leg) with ([hH](?:is|er) heel|such force that your limb dangles uselessly)\.$"
   name="ninjakari_akogh_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = "%1%2"
wounds:monk_attack (nil, part, nil, "kick")
if string.find("%3", "dangles") then
  affs:add_queue ("broken_"..part)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a deft pirouette\, [A-Z][a-z]+ whirls (.+?) about (?:[hH]im|[hH]er)self\, bringing it crashing into the side of your head\.$"
   name="ninjakari_umubah"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head", nil, "%1")
affs:add ("blackout")
if wounds:get ("head") > 800 then
  affs:add_queue({"confusion", "fracturedskull",})
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a look of concentration\, [A-Z][a-z]+ unleashes a powerful kick at your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="ninjakari_kicker"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack (nil, part, nil, "kick")
affs:add_queue ("numb", part)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ whips you with (.+?)\, lashing the skin from your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="ninjakari_whoopin"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack ({"Ninjakari",}, part, nil, "%1")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) wraps .+? about [hH](?:is|er) wrists and wrenches it violently from you\, tearing skin and mincing flesh\.$"
   name="ninjakari_yank"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>for k, p in ipairs({ "chest", "gut", "head", "leftarm", "leftleg", "rightarm", "rightleg", "body" }) do
  if affs ["grapples"] [p] == "%1" then
    wounds:monk_attack (nil, p, nil, "%1")
  end
end
prompt:queue (function ()
	affs:add ("grappled", nil, "%1")
end, "ungrappled_%1", true)
EnableTriggerGroup ("System_NinjakariMods", true)
prompt:queue (function ()
EnableTriggerGroup ("System_NinjakariMods", false)
end, "ninjakari_wrench")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With the whistling of .+? reaching a high-pitched whine\, [A-Z][a-z]+ swings [hH](?:is|er) chain into your gut\, tearing open the torso as organs burst forth in an explosion of blood\.$"
   name="ninjakari_ughathalogg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut", nil, "ughathalogg")
system:poisons_on ()
affs:add_queue("burstorgans")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With the whistling of .+? reaching a high-pitched whine\, [A-Z][a-z]+ swings [hH](?:is|er) chain at you\, but you are able to jump mostly out of the way for a glancing blow\.$"
   name="ninjakari_ughathalogg_glancing"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut", nil, "ughathalogg")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a flick of [hH](?:is|er) wrist\, [A-Z][a-z]+ wraps .+? around your head and then jerks it off with a violent twist\, causing your skull to crack and bleed\.$"
   name="ninjakari_ninthugi_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head", nil, "ninthugi")
affs:add_queue("fracturedskull")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a flick of [hH](?:is|er) wrist\, [A-Z][a-z]+ wraps .+? around your gut and then jerks it off with a violent twist\, causing the blood to spout from your mouth\.$"
   name="ninjakari_ninthugi_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut", nil, "ninthugi")
affs:add_queue("dysentery")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a flick of [hH](?:is|er) wrist\, [A-Z][a-z]+ wraps .+? around your chest and then jerks it off with a violent twist\, causing your ribcage to crack and splinter\.$"
   name="ninjakari_ninthugi_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest", nil, "ninthugi")
affs:add_queue("brokenchest")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a flick of [hH](?:is|er) wrist\, [A-Z][a-z]+ wraps .+? around your (left|right) (arm|leg) and then jerks it off with a violent twist\, causing your limb to twist at an alarming angle\.$"
   name="ninjakari_ninthugi_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1%2", nil, "ninthugi")
affs:add_queue("twisted_%1%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ snaps .+? at your throat\, crushing your windpipe\.$"
   name="ninjakari_ninombhi_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head", nil, "ninombhi")
affs:add_queue ("windpipe")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ snaps .+? at your chest\, snapping some ribs\.$"
   name="ninjakari_ninombhi_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest", nil, "ninombhi")
affs:add_queue("snappedrib")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ snaps .+? at your gut\, making you double over and spew bloody vomit\.$"
   name="ninjakari_ninombhi_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut", nil, "ninombhi")
affs:add_queue("vomiting")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ snaps .+? at your (left|right) (arm|leg)\, which then dangles uselessly at your side\.$"
   name="ninjakari_ninombhi_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1%2", nil, "ninombhi")
affs:add_queue ("lacerated", "%1%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lashes out at your gut with .+?\, rupturing it and leaving a gaping wound\.$"
   name="ninjakari_ashlamkh_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut", nil, "ashlamkh")
affs:add_queue ("rupturedstomach")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lashes out at your chest with .+?\, crushing it with a heavy thud and making breathing difficult\.$"
   name="ninjakari_ashlamkh_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest", nil, "ashlamkh")
affs:add_queue("crushedchest")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lashes out at your (left|right) (arm|leg) with .+?\, mangling it with a fleshy thud\.$"
   name="ninjakari_ashlamkh_limb_mangle"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1%2", nil, "ashlamkh")
affs:add_queue ("mangled_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lashes out at your (left|right) (arm|leg) with .+?\, snapping the bone with a crunch\.$"
   name="ninjakari_ashlamkh_limb_break"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1%2", nil, "ashlamkh")
affs:add_queue ("broken_%1%2")
if "%2" == "leg" then
  affs:prone()
end
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lashes out at your head with .+?\, causing (?:it|your jaw) to shatter into pieces\.$"
   name="ninjakari_ashlamkh_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head", nil, "ashlamkh")
affs:add_queue("shatteredjaw")
system:poisons_on ()</send>
  </trigger>
  
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^The chain catches your ankle and pulls your feet from under you\.$"
   name="ninjakari_dhatogh"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Jerked off your feet\, you slam heavily against the ground\.$"
   name="ninjakari_jerks"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone({"prone", "stun"})</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^.+? spins you in a circle so fast that you are left reeling and nauseous\.$"
   name="ninjakari_bhaddogho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({"dizziness", "confusion"})
affs:prone("stun")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^The chain catches around your flailing (left arm|left leg|right arm|right leg)\, snapping tight with the screech of metal and twisting it in a hideous contortion of mangled flesh\.$"
   name="ninjakari_twisted"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local limb = string.gsub("%1", " ", "")
affs:add_queue("twisted_" .. limb)
wounds:monk_attack (nil, limb)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^.+? loops about your head\, then suddenly pulls taut\, fracturing your skull with a sickening crunch\.$"
   name="ninjakari_fracture_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("fracturedskull")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Blood pours from the jagged wounds on your head\.$"
   name="ninjakari_illgathoru_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 175)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^You reel backwards as blood splurts out of your chest\.$"
   name="ninjakari_illgathoru_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("phrenicnerve")
affs:add_queue ("bleeding", 175)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^The chain tears open your belly\, causing bloody innards to be exposed\.$"
   name="ninjakari_illgathoru_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("slicedopengut")
affs:add_queue ("bleeding", 175)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (left|right) leg buckles as the chain nearly saws it off\.$"
   name="ninjakari_illgathoru_leg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("tendon_%1leg")
affs:add_queue ("bleeding", 175)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^You scream as the chain tears through a nerve in your (left|right) arm\.$"
   name="ninjakari_illgathoru_arm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("collapsednerve_%1arm")
affs:add_queue ("bleeding", 175)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^White hot pain stabs through your head as the chain lashes it with a sickening crack\, ripping away chunks of your scalp\.$"
   name="ninjakari_concussion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("concussion")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^You vomit up hot blood as your chest crumples inward like wet parchment from the chain\'s impact\.$"
   name="ninjakari_crush_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("crushedchest")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^You choke up bile and blood as your stomach ruptures\, your skin blotching with angry bruises from internal bleeding\.$"
   name="ninjakari_rupture_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("rupturedstomach")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (chest|gut|head|left arm|left leg|right arm|right leg) numbs as the entangled .+? cuts off the flow of blood and constricts the nerves\.$"
   name="ninjakari_numb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("numb_" .. (string.gsub("%1", " ", "")))</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (left|right) leg shatters under the force of the blow\.$"
   name="ninjakari_ninughi_leg1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1leg")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (left|right) arm breaks with a loud crack\.$"
   name="ninjakari_ninughi_arm1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1arm")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (left|right) leg buckles as your kneecap emits a loud popping crack\.$"
   name="ninjakari_ninughi_leg2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("kneecap_%1leg")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (left|right) arm flops uselessly as your elbow emits a loud popping crack\.$"
   name="ninjakari_ninughi_arm2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("elbow_%1arm")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^.+? wraps tightly round your gut\, crushing your stomach and bringing up its contents in a flood of blood\-flecked vomit\.$"
   name="ninjakari_vomit"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vomiting")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Coiling around your throat in ever tighter twists\, .+? crushes your windpipe\.$"
   name="ninjakari_crush_pipe"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("windpipe")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your (chest|gut|head|left arm|left leg|right arm|right leg) numbs as the entangled .+? cuts off the flow of blood and constricts the nerves\.$"
   name="ninjakari_numb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:add_simple ("numb_" .. (string.gsub("%1", " ", "")))
end, "ninjakari_numb", true)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^You begin to twitch uncontrollably\.$"
   name="ninjakari_tremble"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("trembling")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^[A-Z][a-z]+ jerks back .+? as it strikes\, lacerating the flesh\.$"
   name="ninjakari_blood"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 100)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^Your nose is savagely \w+ and breaks\, causing blood to splurt forth\.$"
   name="ninjakari_breaknose"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("brokennose")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_NinjakariMods"
   match="^.+? rips from your throat with such force that bits of flesh fly into the air and your head almost spins around in a full circle\.$"
   name="ninjakari_constrict"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>


<!-- KATA - SHOFANGI -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ smashes your (left|right) leg with (.+?)\, splintering your kneecap\.$"
   name="shofangi_kneecap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has("kneecap_%1leg") then
  affs:add_queue ("broken_%1leg")
else
  affs:add_queue("kneecap_%1leg")
end
stance:reset ()
wounds:monk_attack ({"Shofangi",}, "%1leg", nil, "%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your elbow splinters as [A-Z][a-z]+ smashes your (left|right) arm with (.+?)\.$"
   name="shofangi_boganj_arm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has("elbow_%1arm") then
  affs:add_queue ("broken_%1larm")
else
  affs:add_queue("elbow_%1arm")
end
parry:reset ()
wounds:monk_attack ({"Shofangi",}, "%1arm", nil, "%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swiftly stomps on your (left|right) (arm|leg)\, causing you to wince\.$"
   name="shofangi_stomp_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = "%1%2"
wounds:monk_attack ({"Shofangi",}, part, nil, "stomp")
prompt:queue (function ()
if string.find (prompt ["status"], p) then
  affs:add ("broken_"..part)
else if "%2" == "leg" then
	affs:add ("crushedfoot_%1leg")
end
end, "stomp_limb", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swiftly stomps on your (chest|gut|head)\, causing you to wince\.$"
   name="shofangi_stomp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi"}, "%1", nil, stomp)
if affs:has("prone") then
  if "%1" == "chest" then
    affs:add_queue("snappedrib")
  elseif "%1" == "head" then
    affs:add_queue("brokenjaw")
  end
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) drives (.+?) deep into your chest\, hooking (?:it|them) in your ribs\.$"
   name="shofangi_grapple_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "chest", "%1")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack ({"Shofangi",}, "chest", nil, "%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) impales (.+?) deep into your gut\, which spills forth blood\.$"
   name="shofangi_grapple_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "gut", "%1")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack ({"Shofangi",}, "gut", nil, "%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices through your (chest|gut|head|left arm|left leg|right arm|right leg) in a graceful arc with (.+?)\.$"
   name="shofangi_arc"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Shofangi",}, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices across your head with (.+?)\, spilling stinging blood into your eyes\.$"
   name="shofangi_whibuta"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi",}, "head")
defs:del_queue ("sixthsense")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Jumping straight up into the air\, [A-Z][a-z]+ snaps a kick at you and slams a heel into your skull\.$"
   name="shofangi_heelslam_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head")
affs:add_queue("fracturedskull")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Jumping straight up into the air\, [A-Z][a-z]+ snaps a kick at you and slams a heel into your chest\, snapping ribs\.$"
   name="shofangi_heelslam_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest")
affs:add_queue("brokenchest")
affs:prone ("stun")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Jumping straight up into the air\, [A-Z][a-z]+ snaps a kick at you and slams a heel into your gut\, knocking the wind out of you\.$"
   name="shofangi_heelslam_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Jumping straight up into the air\, [A-Z][a-z]+ snaps a kick at you and slams a heel into your (left|right) (arm|leg)\, popping the limb out of its socket\.$"
   name="shofangi_heelslam_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1%2")
affs:add_queue ("dislocated_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ viciously twists (.+?) out of your (chest|gut|head|left arm|left leg|right arm|right leg)\, shredding the flesh into bloody strips\.$"
   name="shofangi_shred"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
affs:add_queue ("grappled", part)
wounds:monk_attack ({"Shofangi",}, part)
affs:add_queue ("bleeding", 100)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ twists [hH](?:is|er) twin shofa painfully deeper into you\, ripping them apart with an elegant twirl\.$"
   name="shofangi_twirl"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	affs:add ("grappled")
end, "ungrappled_%1", true)
wounds:monk_attack (nil, "leftleg")
wounds:monk_attack (nil, "rightleg")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) twists your (left arm|left leg|right arm|right leg) and (left arm|left leg|right arm|right leg) with .+?\, (?:locking (?:it|them) up|pinning (?:it|them) tightly)\.$"
   name="shofangi_grapple_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part1 = string.gsub("%2", " ", "")
local part2 = string.gsub("%3", " ", "")
affs:add_queue ("grappled", part1, "%1")
affs:add_queue ("grappled", part2, "%1")
wounds:monk_attack (nil, part1)
wounds:monk_attack (nil, part2)
system:poisons_on ()
EnableTriggerGroup ("System_ShofangiMods", true)
prompt:queue (function ()
	EnableTriggerGroup ("System_ShofangiMods", false)
end, "shofangi_grapple_limb")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ stomps at you and snorts loudly in your face\, startling you with [hH](?:is|er) rage\.$"
   name="shofangi_bullsnort"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("disrupted")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   keep_evaluating="y"
   match="^[A-Z][a-z]+ leaps at you and slams [hH](?:is|er) head into your face\.$"
   name="shofangi_headbutt"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   keep_evaluating="y"
   lines_to_match="2"
   match="^[A-Z][a-z]+ leaps at you and slams [hH](?:is|er) head into your face\.\nYou suddenly stumble\.$"
   multi_line="y"
   name="shofangi_headbutt_prone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ smashes your head with (.+?)\, shattering your jaw\.$"
   name="shofangi_broken_jaw"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("brokenjaw")
wounds:monk_attack ({"Shofangi",}, "head")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices across your head with (.+?)\, spilling blood into your eyes\.$"
   name="shofangi_eyes"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("sixthsense")
wounds:monk_attack ({"Shofangi"}, "head", 0, "%1")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices cleanly through your mouth with (.+?)\, shredding your tongue\.$"
   name="shofangi_butojo1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi",}, "head")
affs:add_queue("mangledtongue")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ slices (.+?) cleanly through the air in front of you\. You blink several times as it appears that (?:[sS]h|[hH])e missed you\, but then pain blossoms in a line across your neck as blood gushes out of a long\, razor\-thin cut\.$"
   name="shofangi_butojo2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi"}, "head")
affs:add_queue("slitthroat")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You try to speak\, but your mangled tongue inhibits your abilities\.$"
   name="symp_shofangitongue"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("mangledtongue")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You scream in absolute agony and spin violently through the air in a spray of crimson blood\, crashing painfully to the ground elsewhere\.$"
   name="shofangi_bulltoss"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	affs:add ("grappled")
end, "ungrappled_%1", true)
for i=1,3 do
display.warning ("Shofa Throw!")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ powerfully bullkicks your (head|chest|gut)\, impacting with a sickening crunch\."
   name="shofangi_bullkick"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1")
for i=1, 5 do
display.warning("Moved!")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a whirl of [hH](?:is|er) shofa\, ([A-Z][a-z]+) charges recklessly from the \w+ into you\, spearing the twin blades into your ribs and brutally hooking them\, knocking you to the ground\.$"
   name="shofangi_bullcharge"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "gut", "%1")
prompt:unqueue ("ungrappled_%1")
affs:prone()
wounds:monk_attack (nil, "gut", nil, "bullcharge")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swings .+? at you\, but you duck out of its way\.$"
   name="shofangi_quacker"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:del_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your vision goes white with pain as [A-Z][a-z]+ slams your (head|chest|gut) into [hH](?:is|er) raised knee with a loud crunch of bone\.$"
   name="shofangi_crunchy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "%1")
wounds:monk_attack (nil, "%1", nil, "crunch")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ spins [hH](?:is|er) shofa in each hand\, crisscrossing them back and forth in elaborate patterns just before slashing them into your (chest|gut|head|left arm|left leg|right arm|right leg)\.$"
   name="shofangi_shotah"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Shofangi",}, part, nil, "shotah")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a flourish\, ([A-Z][a-z]+) jerks out the blades embedded in the bones of your arms\, sending bone fragments flying as (?:[sS]h|[hH])e disarms you\.$"
   name="shofangi_disarm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", nil, "%1")
affs:add_queue ("broken_leftarm")
affs:add_queue ("broken_rightarm")
wounds:monk_attack (nil, "leftarm")
wounds:monk_attack (nil, "rightarm")
system:poisons_on ()
EnableTriggerGroup ("System_ShofangiMods", true)
prompt:queue (function ()
	EnableTriggerGroup ("System_ShofangiMods", false)
end, "shofangi_disarm")
affs:add_queue ("disarmed", "silent")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ wildly twists and turns\, kicking [hH](?:is|er) legs out behind [hH](?:im|er)\. One thunderous kick slams into your (left|right) (arm|leg)\, which flails about limply as the bones are crushed to powder\.$"
   name="shofangi_buck_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi",}, "%1%2")
affs:add_queue ("mangled_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ wildly twists and turns\, kicking [hH](?:is|er) legs out behind [hH](?:im|er)\. One thunderous kick slams into your head\, and the world momentarily fades to black\.$"
   name="shofangi_buck_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")
wounds:monk_attack ({"Shofangi",}, "head")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ wildly twists and turns\, kicking [hH](?:is|er) legs out behind [hH](?:im|er)\. One thunderous kick slams into your gut\, and you double over and spit out blood\.$"
   name="shofangi_buck_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "gut")
affs:add_queue("rupturedstomach")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ wildly twists and turns\, kicking [hH](?:is|er) legs out behind [hH](?:im|er)\. One thunderous kick slams into your chest\, which caves in with a sickening crunch\.$"
   name="shofangi_buck_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest")
affs:add_queue("crushedchest")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ thrusts a clawed fist towards you\, ripping at the air before your face\.$"
   name="monk_raze"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Shofangi"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   keep_evaluating="y"
   match="^[A-Z][a-z]+ razes your (?:aura of rebounding|speed defence) with .*?(?:moonblade|shofa|staghorn|bull\-horn).*?\.$"
   name="shofangi_raze2"
   regexp="y"
   send_to="12"
   sequence="90"
  >
  <send>wounds:monk_attack ({"Shofangi"})</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The .+? hooks your (?:left|right) leg\, sending you tumbling\.$"
   name="shofangi_hook"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ()</send>
  </trigger>


<!--SHOFANGI MODS-->
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^Bones crunch under the force of the blow\.$"
   name="shofangi_bullstrength"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = wounds:is_hit ()
if part == "chest" then
  affs:add_queue("brokenchest")
elseif string.find(part, "arm") then
  local side = string.sub(part, 1, -4)
  affs:add_queue ("broken_"..side.."arm")
elseif string.find(part, "leg") then
  local side = string.sub(part, 1, -4)
  aaffs:add_queue ("broken_"..side.."leg")
end</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^Your skin is scraped by the shofa\, raising angry red welts on the skin\.$"
   name="shofangi_shoflai"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	fst:fire ("salve", "now")
	bals:offbal ("salve")
end, "shoflai", true)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^The blade of .+? shreds the flesh on your (left|right) (arm|leg) into bloody ribbons\.$"
   name="shofangi_rake"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("lacerated", "%1%2")
affs:add_queue ("bleeding", 200)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^A prickly stinging overcomes your body\, fading away into numbness\.$"
   name="shofangi_paralysis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^The massive trauma to your head has damaged your skull and brain considerably\.$"
   name="shofangi_braindamage"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("concussion")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_ShofangiMods"
   match="^You howl in agony as the .+? digs deep and pierces your spine\. Your body suddenly starts to feel numb\.$"
   name="shofangi_spinaltap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>

<!-- Kata - Tahtetso -->
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^With a quick snap of the wrist\, [A-Z][a-z]+ swings .+? about\, slamming one end into your (left|right) arm\. The limb buckles with an audible\, horrible crack as a sharp pain shoots along its length\.$"
   name="tahtetso_bomrakini_arm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fractured_%1arm")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_System_TahtetsoMods"
   match="^With a quick snap of the wrist\, [A-Z][a-z]+ swings .+? about\, slamming one end into your (left|right) leg\. Searing lancets of pain jolt up your leg as your foot is pulverised beneath the weapon\.$"
   name="tahtetso_bomrakini_leg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("crushedfoot_%1leg")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a quick spin\, [A-Z][a-z]+ strikes your (head|chest|gut|left arm|left leg|right arm|right leg) with (.+?)\.$"
   name="tahtetso_tahto"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack ({"Tahtetso",}, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Whirling (.+?)\, [A-Z][a-z]+ slams it bluntly into your (head|chest|gut|left arm|left leg|right arm|right leg) with both hands\.$"
   name="tahtetso_tahtote"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack ({"Tahtetso"}, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You scream as [A-Z][a-z]+ applies pressure with .+?\, dislocating your (head|chest|gut|left arm|left leg|right arm|right leg) with a loud snap\.$"
   name="tahtetso_bomrakobo"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%1", " ", "")
wounds:monk_attack (nil, part)
affs:add_queue ("grappled", part)
if string.find(part, "leg") or string.find(part, "arm") then
  affs:add_queue("dislocated_" .. part)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Stepping behind you\, ([A-Z][a-z]+) locks your head with (.+?)\, choking you\.$"
   name="tahtetso_bairak"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head")
affs:add_queue ("grappled", "head", "%1")
prompt:unqueue ("ungrappled_%1")
affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a swift drive\, [A-Z][a-z]+ jabs your head with (.+?)\.$"
   name="tahtetso_bairakobo"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head")
affs:add_queue ("grappled", "head")
affs:add_queue ("windpipe")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swings [hH](?:is|er) leg high into the air at your head(\, sending you reeling)?\.$"
   name="tahtetso_starkick"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "head")
if #"%1" > 0 then
  affs:prone ({"prone", "confusion"})
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sweeps .+? in a low\, wide circle\, attempting to trip [hH](?:is|er) foes\.$"
   name="tahtetso_tidesweep"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ({"Tahtetso",})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ cracks (.+?) precisely into your (left|right) (arm|leg)\, causing spasms to numb your stiffening (?:side|muscles)\.$"
   name="tahtetso_bomol"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if "%3" == "arm" then
  affs:add_queue("hemiplegy_%2")
else
  affs:add_queue("hemiplegy_legs")
end
wounds:monk_attack (nil, "%2%3")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cough and wheeze as [A-Z][a-z]+ strikes (.+?) into your chest\, the vibrations constricting your lungs\.$"
   name="tahtetso_gahtisho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest")
affs:add_queue ("asthma")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Swept low by (.+?)\, you howl in agony as [A-Z][a-z]+ strikes your (left|right) leg and shatters your ankle\.$"
   name="tahtetso_bomolahsho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%2leg")
affs:add_queue("shatteredankle_%2leg")		
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You lose consciousness as ([A-Z][a-z]+) continues to choke you with [hH](?:is|er) tahto staff\.$"
   name="tahtetso_choking"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("grappled", "head", "%1")
prompt:unqueue ("ungrappled_%1")
wounds:monk_attack (nil, "head", 0, "tahto")
affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sweeps (.+?) into your (head|chest|gut|left arm|left leg|right arm|right leg) with a loud crack\, causing the staff to vibrate\."
   name="tahtetso_tahtosho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack (nil, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sweeps (.+?) into you\, sending painful vibrations up your gut\.$"
   name="tahtetso_gotisho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack ("gut")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Swinging (.+?)\, [A-Z][a-z]+ bumps your (head|chest|gut|left arm|left leg|right arm|right leg) to little effect\.$"
   name="tahtetso_bump"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local part = string.gsub("%2", " ", "")
wounds:monk_attack (nil, part)
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swings .+? in a circle before smashing one end into the side of your gut\, echoing a sickening crack as you lose all control over your body\.$"
   name="tahtetso_raktiahsho_gut"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>wounds:monk_attack ({"Tahtetso",}, "gut")
affs:add_queue ("severedspine")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a quick spin\, [A-Z][a-z]+ strikes your head with .+?\,? and the world around you spins\.$"
   name="tahtetso_raktiahsho_head"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>wounds:monk_attack (nil, "head")
affs:add ("blackout")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swings .+? in a circle before smashing one end into the side of your (left|right) (arm|leg)\. You can only look away\, the distant pain telling you the limb has been mangled beyond use\.$"
   name="tahtetso_raktiahsho_limb1"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>wounds:monk_attack (nil, "%1%2")
affs:add_queue("mangled_%1%2")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ swings .+? in a circle before bringing it through your (left|right) (arm|leg)\. A horrific pain washes over you as (?:the bone snaps|(?:[hH]|[sS]h)e sweeps you off the ground\, the limb flailing in the air at an unnatural angle)\.$"
   name="tahtetso_raktiahsho_limb"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>wounds:monk_attack (nil, "%1%2")
affs:add_queue ("broken_%1%2")
if "%2" == "leg" then
  affs:prone()
end
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your lungs fill with fluid as [A-Z][a-z]+ swings .+? in a circle before smashing one end into the side of your chest\, knocking the air from your lungs\. You gasp\, but only blood takes its place\.$"
   name="tahtetso_raktiahsho_chest"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>woundsmonk_attack (nil, "chest")
affs:add_queue("collapsedlungs")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your (left|right) arm\. You gasp in agony as your fingers loosen their grip on (.+?)\.$"
   name="tahtetso_raktisho_arm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "%1arm")
system:poisons_on ()
if defs:has ("grip") then
  defs:del_queue ("grip")
else
  affs:add_queue ("disarmed")
end--if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your chest\. You are dimly aware of your ribs splintering in dozens of places as you fall backwards to the ground\.$"
   name="tahtetso_raktisho_chest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack(nil, "chest")
system:poisons_on ()
affs:prone ()
affs:add_queue ("brokenchest")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your chest\. You stumble backwards\, trying to stay standing while your ribs feel as though they\'ve splintered into a hundred pieces\.$"
   name="tahtetso_raktisho_chest1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack (nil, "chest")
system:poisons_on ()
affs:add_queue("brokenchest")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your (left|right) leg\. Your vision spins\, capturing all that is above you in a fleeting glimpse before it is consumed by the ground\.$"
   name="tahtetso_raktisho_leg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack(nil, "%1leg")
system:poisons_on ()
affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your head\, sending a thick fog over your consciousness\.$"
   name="tahtetso_raktisho_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack(nil, "head")
system:poisons_on ()
affs:add_queue("scrambledbrain")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ steps forward with one foot and simultaneously slams .+? into your gut\. You stumble backwards\, your head ringing painfully\.$"
   name="tahtetso_raktisho_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>wounds:monk_attack(nil, "head")
system:poisons_on ()
affs:prone ("stun")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^You gasp and clutch your chest as it is struck with a crack\.$"
   name="tahtetso_gahtiahsho"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("chestpain")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^.+? grinds into your jaw\, crushing the bones\.$"
   name="tahtetso_rakto_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("brokenjaw")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^.+? grinds into your (left|right) (arm|leg)\, crushing the bones\.$"
   name="tahtetso_rakto_limb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1%2")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^.+? grinds into your gut\, tearing through your nerve centers\.$"
   name="tahtetso_rakto_gut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^Your (left|right) leg is hit with a loud crack\, breaking your kneecap and causing your leg to twist unnaturally\.$"
   name="tahtetso_raktiini_leg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("kneecap_%1leg")</send>
  </trigger>
   <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^You are hit by the sweep and topple to the ground\.$"
   name="tahtetso_tideswept"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^Your (left|right) arm breaks with a loud crack\.$"
   name="tahtetso_bomrakini_arm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("broken_%1arm")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^Your nose is savagely hit and breaks\, causing blood to splurt forth\.$"
   name="tahtetso_bomrakini_head"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("brokennose")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^You are hit by the sweep and topple to the ground\.$"
   name="tahtetso_tideswept"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^Your (left|right) leg shatters under the force of the blow\.$"
   name="tahtetso_shatter"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("broken_%1leg")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^You draw breath in short\, rasping gasps from the pain in your chest\.$"
   name="tahtetso_rasp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("shortbreath")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^You\'re thrown off balance and fall down from the whirling strike\.$"
   name="tahtetso_dervish"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_TahtetsoMods"
   match="^[A-Z][a-z]+ twists .+? painfully as it strikes\.$"
   name="tahtetso_twister"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 100)</send>
  </trigger>

<!-- Music -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ plays .+? and your magical shield dissipates into nothingness\.$"
   name="affblanknote1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("shield")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ plays .+?\, and you cry out as your deaf ears open up to the sound of a high\-pitched note\.$"
   name="affblanknote2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blanknote")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^[A-Z][a-z]+ appears to play .+?\, but you hear no sound\.\nYou cry out as your deaf ears open up to the sound of a high\-pitched note\.$"
   multi_line="y"
   name="affblankchord"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blanknote")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ache in your ear canals suddenly intensifies\, leaving you with nothing but a splitting headache\.$"
   name="affblanknote"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("truehearing")
affs:add_queue ("blanknote")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The reverberating sound echoes through your head\, pounding you with excruciating pain\.$"
   name="affminorsecond"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")
-- TODO: auto-enable truehearing?</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the whispers enter your mind\, a sinking feeling drops into the pit of your stomach\.$"
   name="affegovice1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("egovice")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You hear strange whispers\, and a sharp pain stabs you between the eyes\.$"
   name="affegovice2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("egovice")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your head begins throbbing to the beat of the ominous noise\.$"
   name="affmanabarbs1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("manabarbs")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You hear an ominous sound\, and a dull pain stab throbs throughout your head\.$"
   name="affmanabarbs2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("manabarbs")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You blanch as the high[\-\s]pitched screech settles deep within your mind\.$"
   name="affachromatic"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("achromaticaura")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The jarring sound causes a cold pain to stab you in the forehead\.$"
   name="affpowerspikes1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("powerspikes")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You hear a dark thrumming\, and pain wracks your entire being\.$"
   name="affpowerspikes2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("powerspikes")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A strange vibration prevents you from (healing spiritual curses|healing auric ailments|focusing your spirit)\.$"
   name="symp_maestoso"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning ("Maestoso! Cover your ears!")
if (string.find("%1", "spirit") and flags:is_sent ("focus_spirit")) then
  fst:fire ("focus_spirit", "now")
  system:del_cure ()
elseif flags:is_sent ("eat_horehound") then
  fst:fire ("herb", "now")
  system:del_cure ()
else
  return
end
prompt:queue(function () 
	affs:add ("maestoso")
	fst:enable ("maestoso")
end, "symp_maestoso", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You breathe a sigh of relief as the reverberating ringing note here fades away\.$"
   name="affmaestoso_gone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
	fst:fire ("maestoso", "now")
end, "maestoso_gone", true)</send>
  </trigger>

<!-- Music - Necroscream -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Smoky tendrils rise up around you\, wrapping around your arms and legs and solidifying into iron shackles\. You scream in agony as invisible spikes and other unspeakable implements are driven into your flesh\.$"
   name="affnecroshackles"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")
affs:add_queue("shackled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sick feeling ferments throughout your body\.$"
   name="affnecroplague"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("masked", 1)
EnableTrigger ("lostdef_consciousness_plague", true)
prompt:queue (function ()
	EnableTrigger ("lostdef_consciousness_plague", false)
end, "affnecroplague")
display.warning ("You should EAT")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^You feel your grasp over your consciousness slip away with a wrenching feeling of sickness\.$"
   name="lostdef_consciousness_plague"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
defs:lostdef ("consciousness")
if system:is_auto ("consciousness") then
  table.insert (defs ["ubal"], "consciousness")
end
end, "lostdef_consciousness_plague", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cough up some black slime\.$"
   name="affnecrodisease"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:cond ({"poison_worms", "poison_epilepsy",}
prompt:queue (function ()
	system:cond ()
end, "affnecrodisease")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the carilli?on bells thunder in the air\, you are nearly blinded by pain when an angry cough suddenly wracks your body\.$"
   name="affnecroknell"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")
if not affs:has("epilepsy") and
   not affs:has("pox") and
   not affs:has("rigormortis") and
   not affs:has("scabies") and
   not affs:has("worms") 
	then
  affs:masked (2)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The wrathful canticle of Ashtorath rings ominously in your ears\.$"
   name="affnecrocanticle"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local plague = 0
for k, a in ipairs({ "pox", "scabies", "epilepsy", "worms", "rigormortis" }) do
  if affs:has(a) then
    plague = plague + 1
  end
end
if plague &gt;= 5 then
  affs:add_queue("vapors")
elseif plague == 0 then
  affs:freezing ()
else
  local wrath = {
    [1] = "recklessness",
    [2] = "confusion",
    [3] = "stupidity",
    [4] = "sensitivity"
  }
  affs:add_queue(wrath[plague])
end
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the carilli?on bells thunder in the air\, you are nearly blinded by pain when an angry cough suddenly wracks your body\.$"
   name="affnecrocarrillon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You screem in agony as the violent chord threatens to rip you asunder\.$"
   name="affnecrodiscordant"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")
</send>
  </trigger>

<!-- Music - Shadowbeat -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the cawing sound of the music pierces into your mind\, visions out of your deepest nightmares rise up to plague you\. Something deep within you snaps\, and you find yourself unable to do anything but gibber madly\.$"
   name="affshadowbeat1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "epilepsy", "confusion", "stupidity" })
if 
  not defs:has ("truehearing") and
  not affs:has ("deafness")
    then
  affs:prone ("stun")
end
affs:add_queue ("bleeding", 300)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Wounds open up all over your body and you start to bleed\.$"
   name="affshadowbeat2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hemophilia")
affs:add_queue ("bleeding", 200)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The beat of the music pounds into your head\, and you cannot stop yourself from dancing wildly to the rhythm\.$"
   name="affshadowbeat3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your bleeding wounds sting painfully\, causing your limbs to stiffen up\.$"
   name="affshadowbeat4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>

<!-- Music - Starhymn -->
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^The song of an angelic choir fills the air with a blazing white light\.\nYou find you must cover your eyes and drop to your knees\.$"
   multi_line="y"
   name="affstarhymn1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
prompt:queue (function ()
	if affs:has ("prone") then defs:lostdef ("sixthsense") end
end, "starhymn1", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Filled with a haunting sorrow and unlimited love\, an excruciatingly beautiful note brings tears to your eyes and a lump to your throat\. Time slows and momentarily a vision fills your eyes of a goddess floating over an ancient pool with tears streaming down her face\.$"
   name="affstarhymn2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("aeon")
affs:add ("blackout")
EnableTrigger("curejinx", true)
prompt:queue (function () EnableTrigger("curejinx", false) end, "affstarthymn2", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You find yourself unwilling to eat while this music is playing\.$"
   name="affstarhymn3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if bals:get ("herb") == 0.5 and
  not string.find ((flags:get ("applying") or "nil"), "apply_arnica_to") and
  not flags:get ("smoking")
	then
  prompt:queue (function () fst:fire ("herb", "now") end, "affstarhymn3", true)
end--if
if flags:get("sparklies") then
  prompt:queue (function () fst:fire ("sparklies", "now") end, "affstarhymn3", true)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You find yourself unwilling to drink while this music is playing\.$"
   name="affstarhymn4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
  if bals:get ("elixir")==0.5 and not string.find (flags:get ("applying_salve") or "nil", "apply_health_to_") then fst:fire ("elixir", "now") end
  if bals:get ("purg")==0.5 then fst:fire ("purg", "now")end
  if bals:get ("speed") ==0.5 then fst:fire ("purg", "now") end
  if flags:get ("orgpotion") then fst:fire ("orgpotion", "now") end
  if flags:get ("brew") then fst:fire ("brew", "now") end
  if bals:get ("ah") ==0.5 then fst:fire ("ah", "now") end
  end, "starhymn4", true</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The light of Holy Celestia surrounds you as blessed (Elohora|Japhiel|Methrenton|Raziela|Shakiniel) judges the unworthy\.$"
   name="affstarhymnchorale"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("deafness") then
  if "%1" == "Elohora" then
    affs:prone("paralysis")
  elseif "%1" == "Japhiel" then
    affs:add_queue("hallucinations")
  elseif "%1" == "Methrenton" then
    affs:add_queue("recklessness")
  elseif "%1" == "Raziela" then
    affs:add_queue("pacifism")
  else
    affs:add_queue("paranoia")
  end
end</send>
  </trigger>

<!-- Music - Wildarrane -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The shimmering image of White Hart appears and stares directly at you\. As the ghostly spirit throws back his head and bellows in harmony with the music\, the beauty of his voice blasts you\, causing your entire body to reel against the blinding force\.$"
   name="affwildarrane1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The cold of the snow seeps into your bones\.$"
   name="affwildarrane2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("truehearing")
if defs:has("fire") then
  defs:del_queue("fire")
elseif affs:has ("chills") then
  affs:prone("frozen")
else
  affs:add_queue("chills")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^One of the pale spirits swirling around [A-Z][a-z]+ looms before you\, howling guttural curses that cause your limbs to quiver\.$"
   name="affwildarrane3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("shackled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Three of the pale spirits haunting you disperse in a chilling\, biting winter wind\.$"
   name="affwildarrane4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Four of the pale spirits haunting you flood into your eyes and harrow your mind with disturbing visions of death\.$"
   name="affwildarrane5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("wildarrane5", "herb", "eat pennyroyal")
	affs:masked (1)
end, "affs_add_wildarrane5", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Five of the pale spirits haunting you loom up in a cloud of chilling mist full of the weight of aeons\.$"
   name="affwildarrane6"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if defs:has("fire") then
  defs:del_queue("fire")
  affs:add_queue("chills")
elseif affs:has("chills") then
  affs:prone("frozen")
else
  affs:add_queue("chills")
  affs:prone("frozen")
end
affs:prone ("stun")
flags:add_check ("recklessness")</send>
  </trigger>

<!-- Nature -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ points .+? at you and vines shoot forth\, entangling you with a thorny embrace\.$"
   name="affnaturevines"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ points .+? at you and a beam of flickering light shoots forth\, covering you with colourful flame\.$"
   name="affnatureillum"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("illuminated")</send>
  </trigger>

<!-- Nature - Druidry -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As you stumble through the briars\, you become entangled in the morass of vines and nettles\.$"
   name="affdruidbriars"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Flying insects suddenly swarm you\, covering you with tiny\, painful stings\.$"
   name="affdruidbees"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The tiny red mushrooms on the ground release a cloud of yellow spores\, which travel up your nose and make your eyes water\.$"
   name="affdruidspores"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("masked", 1)
prompt:queue (function ()
	affs:add_custom ("druidspores", "herb", "eat pennyroyal")
	defs:lostdef ("protection", "silent")
end, "affs_add_druidspores", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Hundreds of bloated spiders crawl up your legs\, their painful stings raising red welts on your skin\.$"
   name="affdruidspiders"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()--hits with mactans (chills), anatine (clumsiness) or ibululu (sensitivity)
flags:add_check ("spiders")--no message for sensitivity
prompt:queue (function ()
	if flags:get_check ("spiders") then--so if I get hit with the above, I don't add sensitivity
		affs:add ("sensitivity")
	end--if
end, "spiders", true)
prompt:queue (function () flags:del_check ("spiders") end, "spiders_illusion")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A murder of crows descends from the sky with black wings spread and eyes glowing a malevolent red\, diving at you in a filthy flurry of malevolent talons and beaks\.$"
   name="affdruidmurder"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	if not string.find (prompt.status, "b") then
		affs:add_queue("blacklung")
	end
end, "affs_add_murder", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Small motes of yellow pollen rise up from the wildflowers around you and drift into your mouth\. Your throat begins to scratch\, forcing you to cough\.$"
   name="affdruidpollen"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("asthma")
prompt:queue (function ()
	defs:lostdef ("protection", "silent")
end, "druidpollen", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a grim smile\, [A-Z][a-z]+ touches the trees and sap courses out in a thick syrup that lunges at you\, coating you in the viscid liquid\.$"
   name="affdruidsap1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if flags:get_check ("intrees") then
  affs:add ("sap")
  EnableTrigger("curejinx", true)
  prompt:queue (function () EnableTrigger("curejinx", false) end, "affdruidsap")
end</send>
  </trigger>
<!--PAY BIG ATTENTION TO THIS ONE!!!!-->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The sticky sap coating your body causes you to move unbearably slowly\.$"
   name="affdruidsap2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("sap") then
affs:add ("sap")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Animated branches from the trees above suddenly reach down and clutch you around the waist\, pulling you into their foliage\.$"
   name="affdruidtrees1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:in_trees ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Branches swoop down and lift you up into the trees\.$"
   name="affdruidtrees2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not flags:get_check ("cudgel_raised") then
  affs:add_queue ("in_trees")
  affs:prone ("stun")
else
  flags:del_check ("cudgel_raised")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^.+?stag.+? scoops you up with its antlers and tosses you into the trees\.$"
   name="affdruidtrees3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("in_trees")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The bough you\'re standing on suddenly tilts and branches forcibly hurl you out of the tree\, sending you tumbling to the forest floor\.$"
   name="affdruidtrees4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
flags:del ("climbing")
fst:disable ("climbing")
flags:del_check ("intrees")
display.warning ("Knocked down by Treebane!")
end, "affdruidtrees4", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ pops something into ([hH]is|[hH]er) mouth\, and rolls it around in \1 cheek\. (?:He|She) cups a fist against \1 mouth and spits a sickly green beetle at you\, which burrows into your flesh\.$"
   name="affdruidscarab1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning ("Scarab!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sharp pain starts in your stomach and slowly crawls up your throat\.$"
   name="affdruidscarab2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("scarab")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A viciously thorned vine spears out from a nearby branch and lashes tightly around your (left|right) (arm|leg)\.$"
   name="affdruidthorns"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("lashed_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The end of [A-Z][a-z]\'s cudgel forms a knotty burl and (?:[hH]e|[sS]he) points it at you\. The burl pops and ruptures\, shooting a barrage of splinters into your flesh\.$"
   name="affdruidcudgel"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Squirrels chitter madly but remain unseen in the trees\. You are pelted by acorns that leave welts and bruises\.$"
   name="affdruidsquirrels"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 100)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ scoops [hH](?:is|er) hand through the air as though (?:[hH]e|[sS]he) just caught something\. (?:He|She) then appears to fling something at you but you see nothing\. Curiously\, your skin begins to itch\.$"
   name="affdruiddarkseed1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("darkseed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You scream in agony as thorny vines suddenly sprout out of your skin and wrap you in a bloody embrace\.$"
   name="affdruiddarkseed2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "darkseed", "entangled"})
--fst:enable ("darkseed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The crooked forest paths twist dizzyingly around you\, and you find yourself stumbling through the branches\.$"
   name="affdruidpathtwist1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("dizziness")
EnableTrigger("affdruidpathtwist2", true)
prompt:queue (function () EnableTrigger("affdruidpathtwist2", false) end, "affdruidpathtwist1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Vines from the looming trees drape about your form\, clinging to you as you stumble along the twisted path\.$"
   name="affdruidpathtwist2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>

<!-- Nature - Wicca -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Patchou the Moon Cat stares at you with her eerie silvery\-green eyes\.$"
   name="affpatchouaeon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("aeon")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows gather around the form of Black Shuck\, the Darkhound as he opens his mouth fully\, spewing forth darkness which forces its way down your throat and into your lungs\.$"
   name="affshucklung"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blacklung")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Black Shuck\, the Darkhound barks piercingly at you\, the concussion of the sound causing your muscles to lock up\.$"
   name="affshuckparalysis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A pigwidgeon (?:bound in shadows )?begins to follow you\.$"
   name="affpigwidgeon1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>todo:add ("bal", "pigwidgeon", "lose pigwidgeon")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As you attempt to move\, a pigwidgeon(?: bound in shadows)? maniacally runs in circles between your legs\, causing you to trip\.$"
   name="affpigwidgeon2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
todo:add ("bal", "pigwidgeon", "lose pigwidgeon", 1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A banshee(?: bound in shadows)? stares at you\, then suddenly emits a high\-pitched screech at you\. The soundwaves pierce into your very being\, weakening you in both body and mind\.$"
   name="affbanshee"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning ("Watch mana!")
flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A redcap slashes you with a thin razor\, causing blood to spurt from the wound\, which he soaks up with his little cap\.$"
   name="affredcap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 250)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A barghest lifts his massive head and lets forth a blood curdling howl that pierces through the air\.$"
   name="affbarghest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A slaugh strokes a cold\, beautiful finger across your cheek\, and a cold sweat breaks out upon your brow\.$"
   name="affslaugh"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--rigormortis (marjoram), dysentery (choleric), sunallergy (apply liniment), pox (apply liniment), worms (choleric)
affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("slaugh", "herb", "eat marjoram", nil, true)
	affs:masked (1)
end, "affs_add_slaugh", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The crone crosses her shriveled arms and turns her dark\, penetrating gaze upon you\.$"
   name="affcrone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--disrupted, anorexia, shyness. slickness, vertigo, recklesness, claustrophobia, masochism, confusion, frozen
affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("crone", "herb", "eat calamus", nil, true)
	affs:masked (1)
end, "affs_add_crone", true)
affs:add ("disrupted")
flags:add_check ("recklessness")</send>
  </trigger>

<!-- Psionics - Telekinesis -->
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^.+? floats around you\, then dives at you\.\nIt painfully stabs you\!$"
   multi_line="y"
   name="afftelekdagger"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You fall on your face as your legs are suddenly pulled out from under you\.$"
   name="afftelekprone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"prone", "stun"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sharp pain erupts in your chest\, and your \w+ throbs\.$"
   name="afftelekburst1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("vessel", 3)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sharp pain erupts in your chest\, and blood trickles out of your \w+\.$"
   name="afftelekburst2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("vessel", 3)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The bones of your (left|right) (arm|leg) suddenly snap\.$"
   name="afftelekbrokenlimb"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1%2")
flags:add_check ("telekbrokenlimb", "broken_%1%2")
if "%2" == "leg" then
  EnableTrigger("afftelekfistfall", true)
  prompt:queue (function ()
EnableTrigger("afftelekfistfall", false)
flags:del_check ("telekbrokenlimb")
end, "telekbrokenlimb")
end</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^An invisible force swipes by your leg\, causing you to fall over\.$"
   name="afftelekfistfall"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:unqueue ("affs_add_"..flags:get_check ("telekbrokenlimb"))
affs:prone ()
affs:prone(flags:get_check ("telekbrokenlimb"))</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The bones of your (jaw|ribcage) suddenly snap\.$"
   name="afftelekfist"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if "%1" == "ribcage" then
  affs:add_queue("snappedrib")
else
  affs:add_queue("brokenjaw")
  EnableTrigger("afftelekfistconfuse", true)
  prompt:queue (function () EnableTrigger("afftelekfistconfuse", false) end, "telekfist")
end</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^As the pain of your broken jaw sets in\, you are filled with a sense of confusion\.$"
   name="afftelekfistconfuse"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("confusion")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cough as something gets lodged deep in your throat\.$"
   name="afftelekthroat"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("throatlock")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A tingling sensation ripples over your skin and you begin to sweat profusely\.$"
   name="afftelekslick"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>aaffs:add_queue ("slickness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You put a hand to your throat as an invisible force tightens around your neck and chokes you\.$"
   name="afftelekchoke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning ("Choking!")
affs:add ("blackout")
affs:add_queue ("clot", "unknown")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You gasp as a surging pain strikes you in your (left|right) (arm|hip)\.$"
   name="afftelekclot"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if "%2" == "hip" then
  affs:add_queue ("clot", "%1leg")
else
 affs:add_queue ("clot", "%1arm")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The air around you suddenly erupts into flames\, scorching your body\.$"
   name="afftelekpyre"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
flags:add_check ("recklessness")</send>
  </trigger>


<!-- Psionics - Telepathy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sudden headache makes you rub your temples for relief\.$"
   name="afftelepaff"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("poison_powersap", true)
affs:reject_try ()
prompt:queue(function ()
if affs:has ("prone") then --one of the afflictions was paralysis
  affs:add ("paralysis")
else
  affs:masked (1)
end
end, "affs_add_telepaff", true)
prompt:queue (function ()
EnableTrigger("poison_powersap", false)
end, "telepaff_not_checking")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A terrible lethargy suddenly overwhelms you\, making you feel mentally exhausted\.$"
   name="affpsyvamp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Watch ego!")
flags:add_check ("recklessness")
prompt:queue (function () 
	system ["hme_priority"] = "ego" 
	display.option ("priority", "ego")
	if affs:has ("blackout") then
		flags:add_check ("reset_hme")
	end --if
end, "psyvamp", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the image of ([A-Z][a-z]+) floats before your eyes\, blinding pain explodes behind them\, and they begin to tear up with blood\.$"
   name="afftelepmindblast"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Watch ego!")
flags:add_check ("recklessness")
prompt:queue (function () 
	system ["hme_priority"] = "ego" 
	display.option ("priority", "ego") 
	if affs:has ("blackout") then
		flags:add_check ("reset_hme")
	end --if
end, "mindblast", true)</send>
  </trigger>

<!-- Riding -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ whips (.+?) into a fury\, bucking and racing dangerously in a circle\, trampling the ground in a frenzy\.$"
   name="afftrample1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>trampler = string.lower("%1")
EnableTrigger("afftrample2", true)
prompt:queue (function ()
EnableTrigger("afftrample2", false)
trampler = nil
end, "afftrample1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^(.+?) (?:breaks|crushes|pulverizes|smashes) your (left|right) (arm|leg)\.$"
   name="afftrample2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has ("prone") and string.lower("%1") == trampler then
  affs:add_queue("broken_%2%3")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="you sprawling to the ground\.$"
   name="affridingram"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  
<!-- Rituals -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ whispers your name under [hH](?:is|er) breath as (?:[hH]e|[sS]he) chants\, and you suddenly feel drained and muddled\.$"
   name="affamissio"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Watch mana!")
flags:add_check ("recklessness")
prompt:queue (function ()
	system ["hme_priority"] = "mana"
	display.option ("priority", "mana")
	if affs:has ("blackout") then
		flags:add_check ("reset_hme")
	end --if
end, "affamissio", true)</send>
  </trigger>
  
  <!--AEONICS -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Locking [hH](?:is|er) eyes with yours\, [A-Z][a-z]+ clicks [hH](?:is|er) tongue against the roof of [hH](?:is|er) mouth\. As the rhythm of the clicks slows down\, reality seems to stop and start in sudden jerks\.$"
   name="aff_aeonics_aeon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("afftarotaeon1", true)
EnableTrigger("afftarotaeon2", true)
prompt:queue (function () EnableTrigger("afftarotaeon1", false) EnableTrigger("afftarotaeon2", false) end)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ languidly gestures at you and the world tilts as time itself warps\.$"
   name="aff_aeonics_timewarp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "timewarped", 7)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You have a sudden sense of deja vu\.$"
   name="aff_aeonics_temporalbonds"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "timewarped", 5)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ thrusts [hH](?:is|er) palm towards you\, and you feel the air sizzle around you\.$"
   name="aff_aeonics_timeechoes1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("time_echoes")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You suddenly relive events that happened just moments ago\.$"
   name="aff_aeonics_timeechoes2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has("time_echoes") then
	affs:add_queue ("insawarped", "timewarped", 4)
	prompt:queue (function ()
		affs:add_custom ("echoes2", "herb", "eat pennyroyal", nil, true)
		affs:masked (1)
	end, "affs_add_echoes2", true)	
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ gazes deep into your eyes\, revealing oracular visions of the darkest possible of futures\.$"
   name="aff_aeonics_oracle1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("oracle")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are haunted by the oracular visions of dark possible futures\, which fill you with fear and dread\.$"
   name="aff_aeonics_oracle2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:has("oracle") then
 affs:add_queue ("insawarped", "timewarped", 4)
  prompt:queue (function ()
    affs:add_custom ("oracle2", "herb", "eat wormwood", nil, true)
	affs:masked (1)
  end, "affs_add_oracle2", true)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The white sphere that surrounds [A-Z][a-z]+ pulses\, emitting a high\-pitched screech and flashing a series of bright lights\.$"
   name="aff_aeonics_aeonfield"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger ("aeonics_aeonfieldhit", true)
prompt:queue (function () EnableTrigger ("aeonics_aeonfieldhit", false) end, "aff_aeonics_aeonfield")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The cloying presence of an aeon field envelops you\, causing the air around you to shimmer\.$"
   name="aeonics_aeonfieldhit"
   regexp="y"
   send_to="12"
   sequence="10000"
  >
  <send>EnableTrigger("afftarotaeon1", true)
EnableTrigger("afftarotaeon2", true)
prompt:queue (function () EnableTrigger("afftarotaeon1", false) EnableTrigger("afftarotaeon2", false) end, "aeonfield")
affs:add_queue ("insawarped", "timewarped", 4)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ gestures sharply\, then pushes you into a shimmering rift\. You find yourself frozen and can only look helplessly about you\.$"
   name="aff_aeonics_displaced1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:add ("displacement")
fst:enable ("displacement")
end, "displaced1", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are trapped in time and can only helplessly watch the world pass you by\.$"
   name="aff_aeonics_displaced2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:add ("displacement")
fst:enable ("displacement")
end, "displaced2", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You step back into the normal timestream\.$"
   name="aff_aeonics_displaced3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:del ("displacement")
fst:disable ("displacement")
end, "displaced3", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) punches ([hH](?:is|er)) fist in the air\, and an explosion of light and sound resounds around [hH](?:im|er)\. Holding streams of wavering bands of energy in \2 hand\, \1 whips them back and forth\, sending shockwaves reverbating through the air\.$"
   name="aeonics_timequake"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("aeonics_timequakehit", true)
prompt:queue(function () EnableTrigger("aeonics_timequakehit", false) end, "aeonics_timequake")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Reality wavers and bucks as the world around you stops and starts erratically\. You relive competing\,? possible futures over and over\, which finally calms and leaves you gasping for breath\.$"
   name="aeonics_timequakehit"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("time_echoes")</send>
  </trigger>

<!-- Rituals - Necromancy -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ curses you with the visage of a rotting corpse\.$"
   name="affnecrodisfigure"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("disloyalty")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ points at you and utters a string of terrible sounds\, which leech away your mental reserves\.$"
   name="necroleech"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Watch mana!")
flags:add_check ("recklessness")
prompt:queue (function () 
	system ["hme_priority"] = "mana" 
	display.option ("priority", "mana")
	if affs:has ("blackout") then
		flags:add_check ("reset_hme")
	end --if
end, "leech", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ begins to chant in a deep and baleful voice\, and an iron cross rises up from the ground before you\. Vicious spikes slam into your flesh and nail you to the cross\. You scream in pain and agony as blood is splattered in all directions\.$"
   name="affnecrocrucify"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("crucified") </send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You jerk as the iron cross pulls your limbs\, resulting in a sickening crunch of bones\.$"
   name="affnecrocrucified1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("crucified")
if not affs:has ("broken_leftleg") then
 affs:add_queue ("broken_leftleg")
else
  affs:add_queue ("broken_rightleg")
end
if not affs:has ("broken_leftarm") then
 affs:add_queue ("broken_leftarm")
else
  affs:add_queue ("broken_rightarm")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your crucified state makes that impossible\.$"
   name="affnecrocrucified2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("crucified")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You bleed like a stuck pig upon the iron cross\.$"
   name="affnecrocrucified3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("crucified")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You can\'t concentrate enough to focus on your mind as you are crucified\!$"
   name="affnecrocrucified4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("crucified")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lightly strokes your flesh\, and the cold of the grave seeps into your bones\.$"
   name="affnecrocold"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("chills")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The cold of the grave seeps into your bones\, causing you to shudder\.$"
   name="affnecrocoldaura"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("chills")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The smoke envelops you\, leaving behind a thick coat of sticky slime\.$"
   name="affnecroecto"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ectoplasm")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ chants harshly at you\, while cracking [hH](?:is|er) knuckles loudly\.$"
   name="affnecroshrivel1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("affnecroshrivel2", true)
prompt:queue (function () EnableTrigger("affnecroshrivel2", false) end, "necroshrivel1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The flesh on your (left|right) (arm|leg) shrivels to the bone\.$"
   name="affnecroshrivel2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ pronounces that you are under an ill omen\, and a sense of imminent foreboding descends upon you\.$"
   name="affnecroomen"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("omen")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Several flies from the black cloud of filth fly into your mouth\, turning into a putrid sleaze that makes you gag and choke uncontrollably\.$"
   name="affnecrocontagion"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("contagion", "salve", "apply liniment")
	affs:masked (1)
end, "affs_add_contagion", true)
display.warning("Contagion!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The grim mark on your body suddenly darkens (slightly|greatly|brilliantly)\.$"
   name="affnecrodeathmark"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local marks = 1
if "%1" == "greatly" then
  marks = 2
elseif "%1" == "brilliantly" then
  marks = 3
end
affs:add_queue ("deathmark", math.min(15, (affs:has("deathmark") or 0) + marks))</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ chants harshly while laying ([Hh]is|[Hh]er) hand upon you\. Searing pain flashes through \1 touch and where \1 palm touched\, a deathly mark has been burned into your skin\.$"
   name="necrodeathmark"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("deathmark", 1)</send>
  </trigger>
  
<!-- PARADIGMATICS -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Eyes flashing with rainbow colours\, ([A-Z][a-z]+) stares intently at you\. Strange thoughts and perceptions challenge your grip on reality\. When you finally pull yourself away from \1\'s gaze\, you find yourself twitching and drooling\.$"
   name="aff_para_revelations"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 7)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^H(?:is|er) eyes glowing a fearsome yellow\, [A-Z][a-z]+ stares at you with a burning gaze\, and you cannot help but shudder at the intensity of the malice directed towards you\.$"
   name="aff_para_badluck"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 3)
affs:add_queue ("bad_luck")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^H(?:is|er) eyes glowing a fiery red\, [A-Z][a-z]+ looks at you\, quickly looks away\, then looks back at you with a malicious glint in [hH](?:is|er) eye\.$"
   name="aff_para_greywhispers"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 3)
affs:add_queue("grey_whispers")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You hear whispers that make no sense but tickle the back of your mind and make you want to scream\.$"
   name="para_greywhisperssymp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 3)
affs:add_queue ("add_custom", "greywhisperssymp", "focus", "focus mind")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are distracted by the movement of an impossible creature that you see out of the corner of your eye\.$"
   name="aff_para_eyesnare"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 5)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sudden vision passes through your mind\'s eye\, a vision that is so warped and twisted that it challenges your very perception of reality\.$"
   name="aff_para_visionflux"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 7)
prompt:queue (function ()
	affs:add_custom ("visionflux", "herb", "eat pennyroyal")
	affs:masked (1)
end, "affs_add_visionflux", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A wave of nausea sweeps over you\.$"
   name="aff_para_flux"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 5)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^H(?:is|er) eyes turning into starry orbs of pitch black\, [A-Z][a-z]+ gazes deep into your eyes\. You feel [hH](?:is|er) thoughts boring into your own(\, but you shake your head and cast [hH](?:im|er) out| and you cannot resist the plundering of your spiritual essence\. [A-Z][a-z]+ cries out in triumph and you cannot help but scream in abject pain and humiliation as the core of your very self is laid bare before you)\.$"
   name="aff_para_truename"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if string.find("%1", "humiliation") then
  flags:damaged ()
  if (affs ["insanity"] ["number"] or 0) &lt; 15 then
    affs:add_queue ("insawarped", "insanity", 30)
  else
   affs:add_queue ("insawarped", "insanity", 7)
  end
end
affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An enormous green spider scuttles in\, chasing a glittering butterfly\. The butterfly circles around you\, and the spider jumps on you\, sinking its fangs into your neck and then quickly webbing you in a cocoon\. The butterfly flutters off\, and the spider continues its pursuit after it\.$"
   name="aff_para_butterfly1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone({"entangled", "stun"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^There is a loud explosion in the distance followed by a whistling sound that becomes louder and louder\. You look up and see a glittering butterfly fluttering away\,? followed by the shadow of an enormous boulder\,? which then smashes into you\.$"
   name="aff_para_butterfly2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A billowing black cloud rises up from the ground at your feet\,? as a glittering butterfly flutters away\. The thick vapour clings to you and fills your nostrils with a foul stench\.$"
   name="aff_para_butterfly3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "pox", "scabies", "vomiting", "worms" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A glittering butterfly flutters in and loops around you\. You turn around\, trying to follow its flight path\, and your legs get twisted up\. Arms flailing\, you awkwardly try to keep your balance and end up flipping over\, end over end\, breaking all four of your limbs\.$"
   name="aff_para_butterfly4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"broken_leftleg", "broken_rightleg", "broken_leftarm", "broken_rightarm"),})
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A glittering butterfly alights on the ground at your feet\. The ground suddenly gives way and you drop into a pit as the butterfly flutters away\.$"
   name="aff_para_butterfly5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:del ("climbing")
affs:add_queue ("pit")
if not defs:has ("levitate") then
  affs:add_queue ("broken_leftleg")
  affs:add_queue ("broken_rightleg")
end--if
parry:init ()
stance:init ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A small rift opens up over your head\, and a glittering butterfly flutters through it\. A shaft of brilliant light pours out of the rift and bathes you in a golden glow\.$"
   name="aff_para_butterfly6"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue(function () affs:reset() wounds:reset() defs:del("insomnia") end)</send>
  </trigger>

<!-- Runes -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) slings an? (\w+) rune at you\, hitting you in the chest\.$"
   name="affrunes1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:runes ("%2", nil, "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) slings an? (\w+) rune and an? (\w+) rune at you\, hitting you in the chest\.$"
   name="affrunes2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:runes ("%2", "%3", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An? (\w+) rune whizzes in from the \w+ and hits you in the chest\.$"
   name="affrunes3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:runes ("%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An? (\w+) rune and an? (\w+) rune whiz in from the \w+ and hit you in the chest\.$"
   name="affrunes4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:runes ("%1", "%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ghostly outline of an? (\w+) rune briefly appears in front of you before slamming into your forehead\.$"
   name="affrunes5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:runes ("%1")</send>
  </trigger>

<!-- Sacraments -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ brands you a heretic for your crimes against the Light\.$"
   name="affheretic"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("heretic")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A cloudy vision forms in your mind\'s eye of a towering\, angelic woman with a cobalt blue shield who shouts\, &quot;Heretic\, get thee from the Light\!&quot; She points at you and a bolt of blue lightning slams into you\.$"
   name="sympheretic"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add ("heretic")
	affs:masked (1)
end, "affs_add_sympheretic", true</send>
  </trigger>

<!-- Stealth -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Taking a rope\, [A-Z][a-z]+ quickly trusses you up\, tightening the bindings until you can barely move\.$"
   name="afftrussed1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("trussed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Leaping out from the shadows\, [A-Z][a-z]+ suddenly waylays you\, throwing you to the ground and then standing menacingly over you\.$"
   name="affwaylay1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ carefully rushes directly at you and trusses you up in the most clever manner possible\.$"
   name="affrushtruss"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()
affs:add_queue("trussed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dart flies in from the \w+ and strikes you\.$"
   name="affblowgun"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ dips a dart into a vial\, and then shoots it through a blowgun at you\.$"
   name="affblowgun2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()</send>
  </trigger>

<!-- Tarot -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ hurls a tarot card with the image of the Hanged Man on it at you\. As it reaches you\, a huge mass of rope bursts out of it\, entrapping and hindering you\.$"
   name="afftarothangedman"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("roped")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ stands an Aeon tarot on [hH](?:is|er) palm and blows it at you\.$"
   name="afftarotaeon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("afftarotaeon1", true)
EnableTrigger("afftarotaeon2", true)
prompt:queue (function ()
EnableTrigger("afftarotaeon1", false)
EnableTrigger("afftarotaeon2", false)
end, "tarotaeon")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Your speed defence is destroyed\.$"
   name="afftarotaeon1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
defs:lostdef ("speed")
flags:del ("no_speed")
fst:disable ("speed")
fst:disable ("ondef_speed")
bals:onbal ("speed", "silent")
if flags:get_check ("aeonfield") then
  affs:add ("insawarped", "timewarped", 4)
end
prompt:add_alert ("nospeed", "NO speed", 3)
end, "tarotaeon1", true)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Suddenly your movements through the time stream are slowed\.$"
   name="afftarotaeon2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("curejinx", true)
prompt:queue (function ()
if defs:has ("speed") then
  defs:lostdef ("speed")
  flags:del ("no_speed")
  fst:disable ("no_speed")
  fst:disable ("ondef_speed")
  bals:onbal ("speed", "silent")
  affs:add ("aeon", true)
end--if
if flags:get_check ("aeonfield") then
  affs:add ("insawarped", "timewarped", 4)
end
end, "tarotaeon2", true)
prompt:queue (function () EnableTrigger("curejinx", false) end, "tarotaeon_no_checking")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ throws a Lovers tarot at you and as it strikes true\, you fall hopelessly in love with (?:[hH]er|[hH]im)\.$"
   name="afftarotlovers"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("lovers")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ flings a tarot card at you\, which expands into an image of Juliana\. A set of scales appears above your head and one side of the scale quickly descends\. You have a bad feeling about this\.$"
   name="afftarotjustice"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("justice")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ flings a tarot card at you which turns an ominous\, sickly red before striking you in the head\.$"
   name="afftarotmoon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--confusion (focus mind, penny), stupidity (penny, focus mind), hypersomnia (sanguine)
affs:reject_try ()
prompt:queue (function ()
	affs:add ("moon", "herb", "eat pennyroyal", 10, true)
	affs:masked (1)
end, "affs_add_tarotmoon", true)
</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ flings a tarot card at you\, and a jester appears with a slack jawed expression\. With a mad jingling of his bells\, the fool (?:plants an enormous kiss on your lips\.|pinches your nose and shouts\, \&quot;WHOOP\! WHOOP\! WHOOP\!\&quot;\.?|squirts water at you from a large flower\.)$"
   name="afftarotfool"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	defs:lostdef ("speed")
	affs:masked (1)
end, "affs_add_fool", true)</send>
  </trigger>

<!-- Totems - Crow -->
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^([A-Z][a-z]+) swoops down from the skies towards you\, and grasps you firmly with [hH](?:is|er) talons\.\n(?:He|She) swiftly lifts you\, kicking and screaming\, into the skies\.$"
   multi_line="y"
   name="affcrowhoist"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hoisted")
display.warning("Hoisted by %1!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ regurgitates a chunk of rotting flesh and spits it in your face\, and you cannot help but gag as the warm\, stinking glob slides down your skin\.$"
   name="affcrowspit1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:masked (1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dark spirit rises up from [A-Z][a-z]+ and hisses at you\, spitting a glob of black slime in your face\.$"
   name="affcrowspit2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
	affs:add_custom ("crowspit", "herb", "eat marjoram", nil, true) --this is for rigormortis
	affs:masked (1)
end, "affs_add_crowspit", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With blinding speed\, [A-Z][a-z]+ darts forward and pecks out your (left|right) eye\, and you scream in agony as blood flows down your face\. The eyeball plops messily to the ground\.$"
   name="affcroweyepeck"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("peckedeye_%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The loud caw of a crow from above makes you shiver\, just as [A-Z][a-z]+ suddenly swoops down from the branches above and digs [hH](?:is|er) talons into your flesh\, dragging you back up into the trees\.$"
   name="affcrowtrees"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("in_trees")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   lines_to_match="2"
   match="^[A-Z][a-z]+ retches suddenly before belching loudly\, sending a fresh stench of rotting flesh to waft through the air\.\nYou cannot help but gag as you inhale the rotting stench\, the aroma wrecking your form and causing a sharp inner pain\.$"
   multi_line="y"
   name="affcrowstench"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 300)</send>
  </trigger>

<!-- Totems - Moon -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^With a slow\, jerking dance\, [A-Z][a-z]+ points at you and lowers [hH](?:is|er) arms\, and you feel the world about you slow\.$"
   name="affmoonaeon1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger ("afftarotaeon1", true)
EnableTrigger ("afftarotaeon2", true)
prompt:queue (function ()
	EnableTrigger ("afftarotaeon1", false)
	EnableTrigger ("afftarotaeon2", false)
end, "affmoonaeon1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You feel the world about you slow as the brief outline of the dancing form of [A-Z][a-z]+ passes across your mind\.$"
   name="affmoonaeon2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger ("afftarotaeon1", true)
EnableTrigger ("afftarotaeon2", true)
prompt:queue (function ()
	EnableTrigger ("afftarotaeon1", false)
	EnableTrigger ("afftarotaeon2", false)
end, "affmoonaeon2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ raises [hH](?:is|er) arms and dances around you\, spinning faster and faster\. With each pass around you\, (?:[sS]he|[hH]e) shimmers with a dark beauty while your thoughts become cloudier and cloudier\.$"
   name="affnightdrain"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Watch mana!")
flags:add_check ("recklessness")
prompt:queue (function () 
	system ["hme_priority"] = "mana" 
	display.option ("priority", "mana")
	if affs:has ("blackout") then
		flags:add_check ("reset_hme")
	end --if
end, "lash", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ thrusts [hH](?:is|er) palm towards you and a burst of silver light shoots from it and hits you\, burning you painfully\.$"
   name="affmoonburst"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ moves [hH](?:is|er) feet in a rhythmic dance and raises a palm before [hH](?:is|er) eyes\, blocking you from sight\. As (?:[hH]e|[sS]he) slowly turns widdershins\, a dark silver glow pours down from above\, surrounding you briefly\.$"
   name="affmoondarkmoon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("darkmoon")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The world spins in darkness as the curse of the dark moon hits you\.$"
   name="affmoondark"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Rays of golden light beam out from [A-Z][a-z]+ and strike at you\, overwhelming you with (holy fire|thick vapours|deadly light)\.$"
   name="affcelestphial"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if "%1" == "holy fire" then
  affs:add_queue("ablaze")
  flags:add_check ("recklessness")
  affs:burning()
elseif "%1" == "thick vapours" then
  affs:add_queue("vapors")
  affs:add ("blackout")
else
  affs:add_queue("sunallergy")
end</send>
  </trigger>

<!-- Totems - Night -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sends a tendril of shadows into your face\. You try to cry out as your vision is blotted and spears of pain stab into your eye sockets\.$"
   name="affnightblind"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>defs:del_queue ("sixthsense")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A black shadow materialises in the air before [A-Z][a-z]+ and then quickly strikes you\.$"
   name="affnightshadowstrike"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ grabs you by the back of the neck and pulls you forward into an embrace\. H(?:is|er) cold lips press against the neck\, and you are momentarily frozen in pain as your lifeforce is sucked from you\.$"
   name="affnightkiss"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Whispering to [hH](?:im|er)self\, [A-Z][a-z]+ points at you and a silver light flashes across your field of vision\.$"
   name="affmoonsuccumb1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
affs:add ("succumb")
display.warning ("Watch mana!")
system ["hme_priority"] = "mana"
display.option ("priority", "mana")
if affs:has ("blackout") then
	flags:add_check ("reset_hme")
end --if
end, "affs_add_succumb", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A dark chanting fills your ears as the face of [A-Z][a-z]+ appears before you\, beckoning you to succumb to the shadows\.$"
   name="affmoonsuccumb2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:reject_try ()
prompt:queue (function ()
affs:add ("succumb")
display.warning ("Watch mana!")
system ["hme_priority"] = "mana"
display.option ("priority", "mana")
if affs:has ("blackout") then
	flags:add_check ("reset_hme")
end --if
end, "affs_add_succumb", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A silver light weighs upon you\, draining your mental energies\.$"
   name="affnightsuccumb3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:add ("succumb")
display.warning ("Watch mana!")
system ["hme_priority"] = "mana"
display.option ("priority", "mana")
if affs:has ("blackout") then
	flags:add_check ("reset_hme")
end --if
end, "succumb", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Thick shadows drag against your every action\.$"
   name="sympchoke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>------symp</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Shadows suddenly leap out from every corner\, violently whirling in a sudden surge\. When the shadows dissipate slightly\, you gasp as you feel strands of darkness still cling to you\, binding you to ([A-Z][a-z]+) in a suffocating\, choking embrace\.$"
   name="affnightchoke"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:choke ()
--display.Warning("Shadow Choke! Get away from " .. string.upper("%1") .. "!")
EnableTrigger("curejinx", true)
prompt:queue (function () EnableTrigger("curejinx", false) end, "choked")</send>
  </trigger>

<!-- Totems - Stag -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+\'s feet transform into golden hooves\, and s?he raises one up high and stomps down upon you\, knocking the wind out of your lungs\.$"
   name="affstagstomp1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("disrupted")
affs:prone ()
EnableTrigger("affstagstomp2", true)
prompt:queue (function () EnableTrigger("affstagstomp2", false) end, "stagstomp1")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^Your (left|right) (arm|leg) is crushed under the fierce stomping\!$"
   name="affstagstomp2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("broken_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The form of a ghostly stag settles upon [A-Z][a-z]+\. (?:He|She) raises one golden hoof up high and stomps down upon you\, knocking the wind out of your lungs\.$"
   name="affstagstomp3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("disrupted")
affs:prone ()
EnableTrigger("affstagstomp2", true)
;prompt:queue (function () EnableTrigger("affstagstomp2", false) end, "stagstomp3")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ lowers ([hH]is|[hH]er) head and charges you\, impaling you on \1 antlers\.$"
   name="affstaggore1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("impaled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your health continues to drain away as your impaled body shudders on the end of [A-Z][a-z]+\'s antlers\.$"
   name="affstaggore2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("impaled")s</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Powerful spirits plague you with their terrible presence\.$"
   name="affstagcurse"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:masked (1)
end, "stagcurse", true)</send>
  </trigger>
  
<!-- UNWIELDING -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cease (?:to wield|wielding) (.+?)(?: in your (?:right|left) hand)?\.$"
   name="affunwield1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("unwield", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are not wielding (?:a|an) (.+?)\.$"
   name="affunwield2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if next (offense.current) then
	for id, name in pairs (offense.current) do
		if string.find (id, "%1") then
			affs:add_queue ("unwield",  name)
			break
		end--if
	end--for
end--if</send>
  </trigger>
  
<!-- TRANSMOLOGY -->
	<trigger
	enabled="y"
	group="System_Trackings"
	match="^A swirling beam of light shoots out of the eye of a floating spix directly into your eyes\, transfixing you with a kaleidoscope of colours and shapes\.$"
	name="affspixtransfix"
	regexp="y"
	send_to="12"
	sequence="100"
  >
  <send>if not affs:has("blindness") and
	not defs:has("sixthsense") 
		then
	affs:add_queue("transfixed")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) throws back ([hH](?:is|er)) head and blows a stream of slime out of \2 nose and onto you\.$"
   name="affnoseslime"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ectoplasm")</send>
</trigger>
	<trigger
	enabled="y"
	group="System_Tracking"
	match="^([A-Z][a-z]+) darts out and viciously pecks you with [hH](?:is|er) beak nose\.$"
	name="affnosepeck"
	regexp="y"
	send_to="12"
	sequence="100"
  >
  <send>flags:damaged ()
affs:add_queue ("bleeding", 50)</send>
  </trigger>
	<trigger
   enabled="y"
   group="System_Tracking"
   match="^A squirming sludgeworm rears up and spits a gob of green slime onto you\, covering you in a slick mucous\.$"
   name="affsludgewormmucous"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("mucous")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A puddle of slimy mucous forms under your feet\, causing you to slip and fall\.$"
   name="affsludgewormprone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"prone", "mucous"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The slithering tentacles sprouting from ([A-Z][a-z]+) wrap around you and then snap off of [hH](?:im|er)\, entangling you like bloody ropes\.$"
   name="afftorsoblock"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A screeching morrible places a suckered finger against the nape of your neck\. Your mind reels as dozens of gibbering voices assault you\.$"
   name="affmorrible"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_custom ("morrible", "focus", "focus mind")</send>
  </trigger>
   <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) rakes you across the throat with [hH](?:is|er) claws\.$"
   name="affhandsclaw"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("masked")
affs:add_queue ("bleeding", 70)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) slugs you in the jaw with [hH](?:is|er) enormous fist\.$"
   name="affhandscrush"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()
affs:add_queue ("bleeding", 70)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) screams at you\, \&quot;[^a-z]+\!\&quot;$"
   name="affthroatscream"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("stun")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^An enormous gutteral croak reverberates through the air\, shaking the ground\.$"
   name="affthroatcroak"
   regexp="y"
   send_to="12"
   sequence="10000"
  >
  <send>EnableTrigger("affthroatcroaked", true)
prompt:queue(function () EnableTrigger("affthroatcroaked", false) end, "affthroatcroak")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The grotesque sound causes your insides to churn and you taste blood in your mouth\.$"
   name="affthroatcroaked"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Dozens of hands from a tangled hekoskeri slap at you\, and you feel a cold needle injected into your shoulder\, causing your reactions to slow\.$"
   name="affhekoskeri"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:add_alert ("sluggish", "Sluggish", 30, -1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) sinks [hH](?:is|er) fangs into your neck\, and you feel yourself drained of blood and energy.$"
   name="affmouthbite"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) whispers into [hH](?:is|er) cupped hands\,? and then releases a fluttering madfly\,? which buzzes over to you\.$"
   name="affsmadfly"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("madfly")
fst:enable ("madfly")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A fluttering madfly darts into your ear\, and you hear a horrendously loud buzzing within your skull\. You stumble about trying to clear the impossible visions that plague you\.$"
   name="affmadflyinsanity"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if flags:get_check ("madfly") then
  affs:insawarped ("insanity", 10)
end
EnableTrigger("madfly_gone", true)
prompt:queue (function () EnableTrigger("madfly_gone", false) end, "affmadflyinsanity")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^A fluttering madfly curls up and turns black\, disintegrating into dust\.$"
   name="madfly_gone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>fst:fire ("madfly", true, true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The psychedelic lights around ([A-Z][a-z]+) flare and shoot out at you\.$"
   name="aura_psychedelia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_custom ("psychedelia", "herb", "eat pennyroyal")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Reality shifts and colours explode in your vision as the Inveiglora of Gnostoratu points a dainty finger at you\.$"
   name="illuminati_championmob1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("stupidity")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Laughing softly\, the Inveiglora of Gnostoratu whips her arms at you\, which transform into a mass of tentacles that binds you completely\.$"
   name="illuminati_championmob2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The Inveiglora of Gnostoratu giggles as her hand seizes your throat\, her fingers morphing into tentacles that only tighten their hold\.$"
   name="illuminati_championmob3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^H(?:is|er) eyes glowing a fearsome yellow\, a homunculus resembling a deformed \w+ stares at you with a burning gaze\, and you cannot help but shudder at the intensity of the malice directed towards you\.$"
   name="transmology_homunculus1"
   regexp="y"
   send_to="12"
   sequence="10000"
  >
  <send>affs:add_queue ("insawarped", "insanity", 3)
affs.add_queue("bad_luck")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Baring sharpened teeth dripping with greenish saliva\, a homunculus resembling a deformed \w+ leaps up and bites you\, causing you to tremble and feel feverish\.$"
   name="transmology_homunculus2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 7)
flags:damaged()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^H(?:is|er) eyes glowing a fiery red\, a homunculus resembling a deformed \w+ looks at you\, quickly looks away\, then looks back at you with a malicious glint in [hH](?:is|er) eye\.$"
   name="transmology_homunculus3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("insawarped", "insanity", 3)
affs.add_queue("grey_whispers")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ sinks [Hh](?:is|er) fangs into your neck\, and you feel yourself drained of blood and energy\.$"
   name="affbloodfangs"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()</send>
  </trigger>
  
<!-- HARMONICS -->
	<trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning garnet around ([A-Z][a-z]+) casts a ruddy light onto you\.$"
   name="harmonics_garnet"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged() --mana drain</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ tosses a scintillating stone into the air\, which explodes in a glittering cloud of green and pink motes\.$"
   name="harmonics_mendingstone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger ("harmonics_mendingstonecure", true)
prompt:queue(function () EnableTrigger("harmonics_mendingstonecure", false) end, "harmonics_mendingstone")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As the sparkling motes settles? upon your skin\, you shiver as a powerful healing balm washes over you\.$"
   name="harmonics_mendingstonecure"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:cures_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) holds the pulsating stone aloft just as it detonates in a soundless explosion of white light\.$"
   name="harmonics_balestone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger("harmonics_balestonefire", true)
prompt:queue(function () EnableTrigger("harmonics_balestonefire", false) end)</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Tracking"
   match="^The white light washes over you\, and you stagger back as the balefire erases something deep within you\.$"
   name="harmonics_balestonefire"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged()
affs:add_queue ("insawarped", "timewarped", 7)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning opal around ([A-Z][a-z]+) flashes dark hues onto you\.$"
   name="harmonics_opal"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged()--ego drain</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning onyx around ([A-Z][a-z]+) casts a sickly shadow over you\.$"
   name="harmonics_onyx"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("vapors")--paralyzed, dizzy, violently ill, healthleech, vapors
affs:add ("blackout")
affs:prone("paralysis")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning bloodstone around ([A-Z][a-z]+) bathes you with a bloody light\.$"
   name="harmonics_bloodstone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("bleeding", 175)
--main.attacked("%1", "harmonics", "bloodstone")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The spinning emerald around [A-Z][a-z]+ suffuses you with a deep green glow\.$"
   name="harmonics_emerald"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:cures_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) smashes a chunk of dark rock at [hH](?:is|er) feet and red and black smoke roils about [hH](?:im|er)\.$"
   name="harmonics_malefactgem"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTrigger ("affmalefactgem", true)
prompt:queue(function () EnableTrigger ("affmalefactgem", false) end, "harmonics_malefactgem")</send>
  </trigger>
   <trigger
   enabled="n"
   group="System_Tracking"
   match="^Tendrils of red and black smoke wrap around you\, covering your skin in a sticky film\.$"
   name="affmalefactgem"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("paralysis")
prompt:queue(function () if not affs:has("paralysis") then affs:add_custom ("malefactgem", "focus", "focus mind") end end, "affmalefactgem", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning sapphire around ([A-Z][a-z]+) beams a ray of blue light at you\, causing a piercing headache between your eyes\.$"
   name="harmonics_sapphire"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>--confusion, stupidity, hallucination, pacification, masochism, addiction, impatience, paranoia, hypersomia, gluttony, dementia, and hypochondria
prompt:queue (function ()
	affs:add_custom ("sapphire", "herb", "eat pennyroyal", nil, true)
	affs:add_custom ("sapphire", "focus", "focus mind", nil, true)
end, "sapphire", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Placing a ruby crystal on the palm of [hH](?:is|er) hand\, ([A-Z][a-z]+) stares intently at it until the crystal floats up into the air\. It zooms around your head\, settling into an orbit around you\.$"
   name="harmonics_ruby"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("rubies")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning ruby around you shoots a small ball of balefire at you\.$"
   name="harmonics_rubybalefire"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged()
affs:add_queue ("insawarped", "timewarped")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A spinning ruby crystal around you explodes in your face\.$"
   name="harmonics_rubyexplode"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("rubies", nil, -1)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^([A-Z][a-z]+) presses [hH](?:is|er) palms together and stares at the ring of rubies spinning around your head\. The rubies speed up and you are blinded by the brilliant crimson blaze that rips apart your face and causes time to slow down\, magnifying the agony\.$"
   name="harmonics_shatterplex"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs.del_queue("rubies")
flags:damaged()
affs:add_queue ("insawarped", "timewarped", 50)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^[A-Z][a-z]+ points a amethyst wand at you which releases a stream of corruscating energies which rips into your body\.$"
   name="harmonics_wandattack"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:damaged ()</send>
  </trigger>

<!-- SYMPTOMS -->
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Experiencing a shortness of breath\, you suddenly black out\.$"
   name="symplungblackout"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You attempt to inhale\, but only end up coughing out more black phlegm\.$"
   name="sympblacklung"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blacklung")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cough uncontrollably\, as you hack up some black phlegm\.$"
   name="sympblack_lung2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("blacklung")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You find that you are not yet ready to perform that feat\.$"
   name="sympfeatfail"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>flags:add_check ("recklessness")</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Cures"
   match="^The salve slides off your oily skin\.$"
   name="sympslicksalve"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if bals:get ("salve") == 0.5 then
prompt:queue (function ()
	fst:fire ("salve", "now")
	system:del_cure ()
	affs:add ("slickness")
end, "sympslicksalve", true)
end</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Cures"
   match="^The potion slides off your oily skin\.$"
   name="sympslickhealth"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if bals:get ("elixir") == 0.5 then
prompt:queue (function ()
fst:fire ("elixir", "now")
system:del_cure ()
affs:add ("slickness")
end, "sympslickhealth", true)
end</send>
  </trigger>
  <trigger
   enabled="n"
   group="System_Cures"
   match="^The arnica slides off your oily skin\.$"
   name="sympslickarnica"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if bals:get ("herb") == 0.5 then
prompt:queue (function ()
fst:fire ("herb", "now")
system:del_cure ()
affs:add ("slickness")
end, "sympslickhealth", true)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Copious amounts of blood suddenly splutter from your (chest|gut) onto the ground\.$"
   name="sympslicedcg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if "%1" == "gut" then
affs:add_queue("slicedopengut")
else
affs:add_queue ("slicedchest")
end--if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A copious amount of blood suddenly splutters from your gut onto the ground\, and you slip in the deep red puddle\.$"
   name="sympslicedgut"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("slicedopengut")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sudden itch drives you half\-mad\, and you scratch it furiously\.$"
   name="sympscabies"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("scabies")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Blood begins to slowly drip from your nose\.$"
   name="sympcrotamine1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:del_queue ({"crotamine_2", "crotamine_3", "crotamine_4"})
affs:add_queue ("crotamine_1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cough suddenly\, expelling black fluid with bits of what looks to be tissue suspended in it\.$"
   name="sympcrotamine2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:del_queue ({"crotamine_1", "crotamine_3", "crotamine_4"})
affs:add_queue ("crotamine_2")</send>
  </trigger>
  <trigger
   custom_colour="17"
   enabled="y"
   group="System_Tracking"
   match="^Your legs tremble slightly as a yellow jaundice begins to creep through your now\-pale features\.$"
   name="sympcrotamine3"
   regexp="y"
   send_to="12"
   sequence="100"
   other_text_colour="deeppink"
  >
  <send>affs:del_queue ({"crotamine_1", "crotamine_2", "crotamine_4"})
affs:add_queue ("crotamine_3")</send>
  </trigger>
  <trigger
   custom_colour="17"
   enabled="y"
   group="System_Tracking"
   match="^The dark void of terror fills your mind as\, horribly\, blood begins to seep out of every pore on your body\.$"
   name="sympcrotamine4"
   regexp="y"
   send_to="12"
   sequence="100"
   other_text_colour="deeppink"
  >
  <send>affs:del_queue ({"crotamine_1", "crotamine_2", "crotamine_3"})
affs:add_queue("crotamine_4")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Flames lick around you \- you are on fire\!$"
   name="sympablaze"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("ablaze")
flags:add_check ("recklessness")
affs:burning()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Frustratingly\, your body won\'t respond to your call to action\.$"
   name="sympparalysis1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("severedspine") then
  affs:prone("paralysis")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Paralysed as you are"
   name="sympparalysis2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("severedspine") then
  affs:prone("paralysis")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are paralysed and (?:cannot do that|unable to do that|are unable to drop anything)\.$"
   name="sympparalysis3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("severedspine") then
  affs:prone("paralysis")
end
if flags:get ("prone") then
fst:fire ("prone")
end --if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As you are paralysed\, you cannot give away anything\.$"
   name="sympparalysis4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("severedspine") then
  affs:prone("paralysis")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your state of paralysis prevents you from doing that\.$"
   name="sympparalysis5"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("severedspine") then
  affs:prone("paralysis")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You attempt to stand up\, but your pierced leg gives out and you collapse back to the ground\.$"
   name="sympiercedleg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
if affs:has ("prone") then
  affs:add_custom ("sympiercedleg", "herb", "smoke myrtle", 60)
end--if
fst:fire ("prone")
end, "symppiercedleg", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Heart thumping\, you cannot bear the company of others and depart in terror\.$"
   name="sympshyness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("shyness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A blush begins to creep up your neck and into your face as you come to the reali[sz]ation that there are other people here\!$"
   name="sympshyness2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "fear", "shyness" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Justice is dealt out and your attack rebounds onto you\.$"
   name="sympjustice"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("justice")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Ooh look\! A lovely lake\. Perhaps you\'ll dive in\!$"
   name="symphallucinations1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hallucinations")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Spiders are erupting from your mouth and nose\!$"
   name="symphallucinations2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hallucinations")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are stunned by (?:a vision of divine astral beings|the sight of a massive pink bunny hopping by)\.$"
   name="symphallucinations3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ({"stun", "hallucinations"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You leap up and attempt a graceful swan dive\.\.\.right into the solid ground\.$"
   name="symphallucinations4"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("hallucinations")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are transfixed and cannot (?:do that\. You must writhe to escape|move)\.$"
   name="symptransfixed"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("transfixed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cannot move as both your legs are crippled\.$"
   name="sympcrippled"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ({"broken_leftleg", "broken_rightleg",})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The ground seems to tilt and you fall with a thump\.$"
   name="sympdizziness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("dizziness")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The overwhelming power of .+? forces you to humbly kneel down\.$"
   name="sympkneeling"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The idea of putting something in your stomach sickens you\.$"
   name="sympanorexia1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("anorexia")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The thought of eating sickens you\.$"
   name="sympanorexia2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("anorexia")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Tight bindings (?:cling to you\, making that impossible|prevent you from moving)\.$"
   name="sympentangled"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too tangled up to do that\.$"
   name="sympentangled2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone("entangled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are asleep and can do nothing\. WAKE will attempt to wake you\.$"
   name="sympasleep"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("asleep")
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your mind swirls in a fog as you try to remember what you were doing a moment ago\.$"
   name="sympamnesia"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
fst:autofire ()
end , "sympamnesia", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are being strangled by ."
   name="sympvestiphobia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vestiphobia")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are feeling far too passive to do that\.$"
   name="symppeace"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("peace")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are feeling far too tranquil to attempt such a violent act\.$"
   name="symppacifism"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("pacifism")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are gripped with fear \- you cannot leave the ground\.$"
   name="sympvertigo1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vertigo")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You look downwards and the ground spins dizzily beneath you\.$"
   name="sympvertigo2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vertigo")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too afraid of heights to climb up\.$"
   name="sympvertigo3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("vertigo")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are overcome by it all and topple over in a dead faint\.$"
   name="sympvapors"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ("blackout")
flags:add_check ("vapors")
affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:You are bound and cannot move|You are shackled and cannot do that)\.$"
   name="sympshackled"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("shackled")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your empty eyesockets can see nothing but the oblivion of utter darkness\.$"
   name="sympeyes"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
if affs:has ("blindness") then
  affs:add ({ "peckedeye_left", "peckedeye_right" })
end, "sympeyes", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too confused to concentrate properly\.$"
   name="sympconfused"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("confusion")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too stunned to be able to do anything\.$"
   name="sympstunned"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone ("stun")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You begin moving your frozen body slowly \w+\.$"
   name="sympfrozen"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("frozen")
defs:del_queue("fire")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You feel the strength ebb from your body as the cold takes its toll\.$"
   name="sympchills1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("chills")
defs:del_queue("fire")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You have a particularly intense shiver\.$"
   name="sympchills2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({ "chills"})
affs:add ("disrupted")
defs:del_queue("fire")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You lurch forward and vomit out a puddle of blood\.$"
   name="sympvomitingblood"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("vomitingblood")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You must (?:first raise yourself from the floor and stand up|pick yourself off the ground first|first stand up before you can do that)\.$"
   name="sympprone"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:prone()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You realise that you have been left alone \- you must find companionship\!$"
   name="symploneliness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("loneliness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You rush about in a state of utter panic\.$"
   name="sympfear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("fear")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You suffer acute pain as you (?:chew|swallow)\.$"
   name="sympbrokenjaw"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("shatteredjaw") then
  affs:add_queue("brokenjaw")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You swoon as you suffer a toxic relapse\.$"
   name="symprelapse"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("relapsing")
system:poisons_on ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You watch helplessly as your lifeforce drains into [A-Z][a-z]+\.$"
   name="symphealthleech"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("healthleech")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (left|right) (arm|leg) suddenly stiffens and loses all feeling sensation\, rendering it useless\.$"
   name="symprigormortis"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({"rigormortis", "broken_%1%2",})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your bowels turn to water and are voided as you double over from a sharp pain in your stomach\.$"
   name="sympdysentery"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("dysentery")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your hypersomnia prevents your insomnia\.$"
   name="symphypersomnia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hypersomnia")
defs:del_queue("insomnia")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your limbs begin to jerk and shake uncontrollably\, and you begin to foam at the mouth\.$"
   name="sympepilepsy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("epilepsy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your lungs are much too constricted to smoke\.$"
   name="sympasthma1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if flags:get ("smoking") then
	affs:add_queue ("asthma")
end--if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are unable to smoke due to collapsed lungs\.$"
   name="sympasthma2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if flags:get ("smoking") then
	affs:add_queue ("collapsedlungs")
end--if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are too impatient to focus on anything\.$"
   name="sympimpatient"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("impatience")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You cannot contain the convulsions in your stomach any longer and double over\, retching violently\.$"
   name="sympvomiting"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("vomiting")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your blood refuses to clot\.$"
   name="symphemophilia"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if flags:get ("clotting") then
affs:add_queue("hemophilia")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You lash out clumsily\.$"
   name="sympclumsiness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("clumsiness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Something is blocking your throat\, making it impossible to swallow\.$"
   name="sympscarab"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("scarab")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Both (?:of )?your (arms|legs) must be free and (?:unhindered|functioning) to do that\.$"
   name="sympchecklimbs1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:check_limbs ("%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (right|left) hand must be fully functional\.$"
   name="sympchecklimbs2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>system:check_limbs ("arms", "%1")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^As both your arms are dysfunctional\, you cannot do that\.$"
   name="sympchecklimbs3"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if affs:condition ("leftarm")=="healthy" and
	affs:condition ("rightarm")=="healthy" 
		then
	affs:add_queue ("masked", 2)
elseif affs:condition ("leftarm")=="unhealthy" then
	system:check_limbs ("arms", "right")
elseif affs:condition ("rightarm")=="unhealthy" then
	system:check_limbs ("arms", "left")
end--if</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You love [A-Z][a-z]+ far too much to even THINK of hurting (?:[hH]im|[hH]er)\.$"
   name="symplovers"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("lovers")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Sunlight shines down upon you mercilessly\, rippling across your skin like fire\.$"
   name="sympsunallergy1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
affs:del ("sunallergy_2")
affs:add ("sunallergy_1")
end, "sympsunallergy_1", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The sun has rendered you too weak to move a muscle\.$"
   name="sympsunallergy2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
if string.find (prompt ["status"], "p")  then
	affs:del ("sunallergy_1")
	affs:add ("sunallergy_2")
end --if
end, "sympsunallergy_2", true)
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You try to raise the strength in your limbs\, but find yourself too weary\.$"
   name="sympweakness"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("weakness")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Gasping for air\, you faint from sudden exhaustion\.$"
   name="symppuncturedchest"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("puncturedchest")
affs:add ("blackout")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your throat has been locked\, and thus you cannot swallow\.$"
   name="sympthroatlocked"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("throatlock")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You attempt to move\, but the muscles of your legs are locked\.$"
   name="sympleglocked"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("leglock")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You attempt to move\, but the muscles of your legs do not respond\.$"
   name="sympleghemiplegy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("hemiplegy_legs")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The hole in your throat prevents you from swallowing\.$"
   name="sympslitthroat1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("slitthroat")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You try to speak\, but the hole in your throat inhibits your speaking abilities\.$"
   name="sympslitthroat2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("slitthroat")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Blood flows into your (left|right) side inner ear\, inhibiting your sense of balance\.$"
   name="symplostear"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue({"dizziness", "severedear_%1", })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Red rivulets of blood flow down your (left|right) (arm|leg)\.$"
   name="symprivulets"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("sliced_%1%2")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^A sheet of blood rolls down your forehead and into your eyes\.$"
   name="sympfurrowedbrow"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("furrowedbrow")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your crushed windpipe inhibits your ability to swallow\.$"
   name="sympcrushedpipe1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("windpipe")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You try to speak\, but your crushed windpipe inhibits your speaking abilities\.$"
   name="sympcrushedpipe2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue ("windpipe")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You have no arms\!$"
   name="sympseveredarms"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add ({"amputated_leftarm"}, {"amputated_rightarm"})</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Upon reaching your destination your thigh buckles\, causing you to stumble and fall\.$"
   name="sympbucklethigh"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not (affs:has("sliced_leftleg") or affs:has("sliced_rightleg")) then
  affs:masked (1)
end
affs:prone ()</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are unable to maintain a stance for any period of time while your kneecaps are cracked\.$"
   name="sympkneecaps"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
stance:reset ()
if not affs:has("kneecap_leftleg") then
  affs:add ("kneecap_rightleg")
end
end, "sympkneecaps", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You stumble and lose your combat stance\.$"
   name="sympstumblestance"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function () stance:reset () end, "sympstumblestance", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(You must have two(?: good)? legs to do that|Both of your legs are crippled and thus you cannot carry out that action)\.$"
   name="symptwolegs"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>prompt:queue (function ()
  system:check_limbs ("legs")
if flags:get ("prone") and string.find("%1", "must") then
  fst:fire ("prone", "now")
end
end, "symptwolegs", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You immediately throw up what you just ate\.$"
   name="sympgluttony"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("gluttony")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You use your (?:left|right) foot to stomp on your (?:left|right) as hard as possible\.$"
   name="sympmasochism1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("masochism")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^(?:You smile with pleasure as you ram your fist into your jaw|You drive a clenched fist into your gut|With the heel of your palm\, you smack yourself upside the head)\.$"
   name="sympmasochism2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("masochism")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The sharp pain in your foot from the weapon pinning it to the ground makes you incapable of anything other than thinking of escaping it\.$"
   name="symppinleg"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("pinleg") then
  affs:add_queue ("pinleg")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your health continues to drain away as your impaled body shudders on the end of the weapon\.$"
   name="sympimpaled1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("impaled") and not affs:has ("pinleg") then
  affs:add_queue ("impaled")
end</send>
  </trigger>
    <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are impaled\, which makes movement impossible\.$"
   name="sympimpaled2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("impaled") and not affs:has ("pinleg") and not affs:has ("crucified") then
  affs:add_queue ("impaled")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (left|right) arm must be free\.$"
   name="sympfreearm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if system:is_enabled ("armbalance") then
  if
    not affs:has("hemiplegy_%1") and
    not affs:has ("clamped_%1arm") and
    not affs:has ("pierced_%1arm")
      then
    flags:add_check ("check_arm", "%1")
    prompt:queue (function () flags:del_check ("check_arm") end, "sympfreearm")
  end
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your (left|right) arm is off balance\.$"
   omit_from_output="y"
   name="symparmoffbal"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if system:is_enabled ("armbalance") then
  local side = "%1"
  if
    not affs:has("hemiplegy_" .. side) and
    not affs:has ("clamped_"..side.."arm") and
    not affs:has ("pierced_"..side.."arm")
	then
    flags:add_check ("check_arm", side)
    prompt:queue (function () flags:del_check ("check_arm") end, "symparmoffbal")
  end
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your gashed cheek violently spasms\, causing your entire body to jerk reflexively\.$"
   name="sympgashedcheek"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ("gashedcheek")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The mud covering you slows your movement\.$"
   name="sympmuddy"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("muddy")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your movement causes you to sink further into the quicksand\!$"
   name="sympquicksand"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>display.warning("Quicksand! DON'T MOVE!")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The mutt hanging off your arm keeps you from moving\.$"
   name="sympclampedmove"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not affs:has("clamped_leftarm") and not affs:has("clamped_rightarm") then
  affs:add_queue("clamped_rightarm")
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^There is a mangy mutt hanging off your (left|right) arm\!$"
   name="sympclampedarm"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("clamped_%1arm")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are trussed up and must writhe free of the tightly bound ropes\.$"
   name="symptrussed"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("trussed")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The sticky black gunk slows you down as you squelch to the \w+\.$"
   name="sympgunkmove"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("gunk")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You gasp and shiver as you feel yourself losing control of your own power\.$"
   name="symppowersap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("powersap")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The collapsed nerves in your (left|right) arm spasm uncontrollably\, the tremors spreading through your body\.$"
   name="sympcollapsednerve"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:bal ({ "collapsednerve_%1arm", "epilepsy" })</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your heart is filled with divine love\, violence is abhorrent to you\.$"
   name="symppeace"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("peace")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^Your legs collapse from under you and consciousness leaves you as you pass out from extreme hunger\.$"
   name="sympunconscious1"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("unconscious")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are unconscious and thus incapable of action\.$"
   name="sympunconscious2"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("unconscious")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   keep_evaluating="y"
   match="^The lyrical sound invokes a strange longing for [A-Z][a-z]+\.$"
   name="music_perfectfifthed"
   regexp="y"
   send_to="12"
   sequence="99"
  >
  <send>if not system:is_auto("truehearing") then
  system:set_auto ("truehearing", 1)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You find you cannot bear to part from [A-Z][a-z]+\.$"
   name="music_perfectfifthed_still"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>if not (defs:has("truehearing")) and
    not system:is_auto("truehearing") then
  system:set_auto ("truehearing", 1)
end</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You are unable to (?:stand|spring up) with your legs locked\.$"
   name="sympleglock"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>affs:add_queue("leglock")
prompt:queue (function ()
if flags:get ("prone") then
  fst:fire ("prone", "now")
end
end, "sympleglock", true)</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^You move sluggishly into action\.$"
   name="sympaeon"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>sca:check ("slowed", "aeon")</send>
  </trigger>
  <trigger
   enabled="y"
   group="System_Tracking"
   match="^The sticky sap coating your body causes you to move unbearably slowly\.$"
   name="sympsap"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>sca:check ("slowed", "sap")</send>
  </trigger>
  
</triggers>

<!--
  <trigger
   enabled="y"
   group="System_Tracking"
   match=""
   name="symp"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send></send>
  </trigger>


<timers>
  <timer
   name="rainbow_patterns"
   minute="1"
   second="30.00"
   offset_second="0.00"
   send_to="12"
   group="System_Tracking"
  >
  <send>affs:del("rainbow_patterns")
EnableGroup("System_Rainbows", false)
EnableTimer("rainbow_patterns", false)</send>
  </timer>
  <timer
   name="druid_darkseed"
   second="3.00"
   offset_second="0.00"
   send_to="12"
   group="System_Tracking"
  >
  <send>affs:del("darkseed")
EnableTimer("druid_darkseed", false)</send>
  </timer>
</timers>
-->